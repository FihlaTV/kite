(function(){(function(t){function i(i){return"function"==typeof l[i]&&(l[i]=l[i](t,m,u)),l[i]}function n(i,e,n){l[i]=n?e(t,m,u):e}function s(t,i){var e=!1,n=t.charAt(0).toUpperCase()+t.slice(1),s=a.length,r=i.style;if("string"==typeof r[t])e=!0;else for(;s--;)if("string"==typeof r[a[s]+n]){e=!0;break}return e}function r(t){if(t)for(;t.lastChild;)t.removeChild(t.lastChild);return t}function h(t,i){var e=typeof t[i];return"object"==e?!!t[i]:!o[e]}var o={"boolean":1,number:1,string:1,undefined:1},a=["Webkit","Moz","O","ms","Khtml"],m=h(t,"document")&&t.document,u=m&&h(m,"createElement")&&m.createElement("DiV"),c="object"==typeof exports&&exports,d="object"==typeof module&&module,l={};i.add=n,i.clearElement=r,i.cssprop=s,i.isHostType=h,i._tests=l,i.add("dom",function(t,i,e){return i&&e&&h(t,"location")&&h(i,"documentElement")&&h(i,"getElementById")&&h(i,"getElementsByName")&&h(i,"getElementsByTagName")&&h(i,"createComment")&&h(i,"createElement")&&h(i,"createTextNode")&&h(e,"appendChild")&&h(e,"insertBefore")&&h(e,"removeChild")&&h(e,"getAttribute")&&h(e,"setAttribute")&&h(e,"removeAttribute")&&h(e,"style")&&"string"==typeof e.style.cssText});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(f){}"function"==typeof e&&"object"==typeof e.amd&&e.amd?e("has",function(){return i}):c?d&&d.exports==c?(d.exports=i).has=i:c.has=i:t.has=i})(this);var t,i,e;(function(n){function s(t,i){return y.call(t,i)}function r(t,i){var e,n,s,r,h,o,a,m,u,c,d=i&&i.split("/"),l=x.map,f=l&&l["*"]||{};if(t&&"."===t.charAt(0))if(i){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),m=0;t.length>m;m+=1)if(c=t[m],"."===c)t.splice(m,1),m-=1;else if(".."===c){if(1===m&&(".."===t[2]||".."===t[0]))break;m>0&&(t.splice(m-1,2),m-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||f)&&l){for(e=t.split("/"),m=e.length;m>0;m-=1){if(n=e.slice(0,m).join("/"),d)for(u=d.length;u>0;u-=1)if(s=l[d.slice(0,u).join("/")],s&&(s=s[n])){r=s,h=m;break}if(r)break;!o&&f&&f[n]&&(o=f[n],a=m)}!r&&o&&(r=o,h=a),r&&(e.splice(0,h,r),t=e.join("/"))}return t}function h(t,i){return function(){return l.apply(n,w.call(arguments,0).concat([t,i]))}}function o(t){return function(i){return r(i,t)}}function a(t){return function(i){T[t]=i}}function m(t){if(s(g,t)){var i=g[t];delete g[t],v[t]=!0,d.apply(n,i)}if(!s(T,t)&&!s(v,t))throw Error("No "+t);return T[t]}function u(t){var i,e=t?t.indexOf("!"):-1;return e>-1&&(i=t.substring(0,e),t=t.substring(e+1,t.length)),[i,t]}function c(t){return function(){return x&&x.config&&x.config[t]||{}}}var d,l,f,p,T={},g={},x={},v={},y=Object.prototype.hasOwnProperty,w=[].slice;f=function(t,i){var e,n=u(t),s=n[0];return t=n[1],s&&(s=r(s,i),e=m(s)),s?t=e&&e.normalize?e.normalize(t,o(i)):r(t,i):(t=r(t,i),n=u(t),s=n[0],t=n[1],s&&(e=m(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:e}},p={require:function(t){return h(t)},exports:function(t){var i=T[t];return i!==void 0?i:T[t]={}},module:function(t){return{id:t,uri:"",exports:T[t],config:c(t)}}},d=function(t,i,e,r){var o,u,c,d,l,x,y=[];if(r=r||t,"function"==typeof e){for(i=!i.length&&e.length?["require","exports","module"]:i,l=0;i.length>l;l+=1)if(d=f(i[l],r),u=d.f,"require"===u)y[l]=p.require(t);else if("exports"===u)y[l]=p.exports(t),x=!0;else if("module"===u)o=y[l]=p.module(t);else if(s(T,u)||s(g,u)||s(v,u))y[l]=m(u);else{if(!d.p)throw Error(t+" missing "+u);d.p.load(d.n,h(r,!0),a(u),{}),y[l]=T[u]}c=e.apply(T[t],y),t&&(o&&o.exports!==n&&o.exports!==T[t]?T[t]=o.exports:c===n&&x||(T[t]=c))}else t&&(T[t]=e)},t=i=l=function(t,i,e,s,r){return"string"==typeof t?p[t]?p[t](i):m(f(t,i).f):(t.splice||(x=t,i.splice?(t=i,i=e,e=null):t=n),i=i||function(){},"function"==typeof e&&(e=s,s=r),s?d(n,t,i,e):setTimeout(function(){d(n,t,i,e)},4),l)},l.config=function(t){return x=t,x.deps&&l(x.deps,x.callback),l},e=function(t,i,e){i.splice||(e=i,i=[]),s(T,t)||s(g,t)||(g[t]=[t,i,e])},e.amd={jQuery:!0}})(),e("almond",function(){}),e("KITE/kite",["require"],function(){return{}}),e("ASSERT/assert",["require"],function(){var t=function(t,i){var e="assert."+t,n=window.has&&void 0!==window.has(e),s=n?!window.has(e):i;return s?null:function(t,i){var e="function"==typeof t?t():t;if(!e)throw Error("Assertion failed: "+i)}};return t}),e("DOT/dot",["require"],function(){return{}}),e("DOT/Util",["require","ASSERT/assert","DOT/dot"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");e.Util={testAssert:function(){return"assert.dot: "+(i?"true":"false")},clamp:function(t,i,e){return i>t?i:t>e?e:t},rangeInclusive:function(t,i){if(t>i)return[];for(var e=Array(i-t+1),n=t;i>=n;n++)e[n-t]=n;return e},rangeExclusive:function(t,i){return n.rangeInclusive(t+1,i-1)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},lineLineIntersection:function(t,i,n,s){return new e.Vector2(((t.x*i.y-t.y*i.x)*(n.x-s.x)-(t.x-i.x)*(n.x*s.y-n.y*s.x))/((t.x-i.x)*(n.y-s.y)-(t.y-i.y)*(n.x-s.x)),((t.x*i.y-t.y*i.x)*(n.y-s.y)-(t.y-i.y)*(n.x*s.y-n.y*s.x))/((t.x-i.x)*(n.y-s.y)-(t.y-i.y)*(n.x-s.x)))},solveQuadraticRootsReal:function(t,i,e){var n=i*i-4*t*e;if(0>n)return[];var s=Math.sqrt(n);return[(-i-s)/(2*t),(-i+s)/(2*t)]},solveCubicRootsReal:function(t,i,e,s){if(0===t)return n.solveQuadraticRootsReal(i,e,s);if(0===s)return n.solveQuadraticRootsReal(t,i,e);i/=t,e/=t,s/=t;var r=(3*e-i*i)/9,h=(-(27*s)+i*(9*e-2*i*i))/54,o=r*r*r+h*h,a=i/3;if(o>0){var m=Math.sqrt(o);return[n.cubeRoot(h+m)+n.cubeRoot(h-m)-a]}if(0===o){var u=n.cubeRoot(h),c=a-u;return[-a+2*u,c,c]}var d=-r*r*r;d=Math.acos(h/Math.sqrt(d));var l=2*Math.sqrt(-r);return[-a+l*Math.cos(d/3),-a+l*Math.cos((d+2*Math.PI)/3),-a+l*Math.cos((d+4*Math.PI)/3)]},cubeRoot:function(t){return t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3)},linear:function(t,i,e,n,s){return(n-i)/(e-t)*(s-t)+i}};var n=e.Util;return e.testAssert=n.testAssert,e.clamp=n.clamp,e.rangeInclusive=n.rangeInclusive,e.rangeExclusive=n.rangeExclusive,e.toRadians=n.toRadians,e.toDegrees=n.toDegrees,n}),e("DOT/Vector2",["require","ASSERT/assert","DOT/dot","DOT/Util"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");t("DOT/Util"),e.Vector2=function(t,i){this.x=t||0,this.y=i||0};var n=e.Vector2;n.createPolar=function(t,i){return new n(Math.cos(i),Math.sin(i)).timesScalar(t)},n.prototype={constructor:n,isVector2:!0,dimension:2,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y},equals:function(t){return this.x===t.x&&this.y===t.y},equalsEpsilon:function(t,i){return i||(i=0),i>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)},copy:function(){return new n(this.x,this.y)},crossScalar:function(t){return this.x*t.y-this.y*t.x},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t)},timesScalar:function(t){return new n(this.x*t,this.y*t)},times:function(t){return i&&i(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y)},plus:function(t){return new n(this.x+t.x,this.y+t.y)},plusScalar:function(t){return new n(this.x+t,this.y+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y)},minusScalar:function(t){return new n(this.x-t,this.y-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t)},negated:function(){return new n(-this.x,-this.y)},angle:function(){return Math.atan2(this.y,this.x)},perpendicular:function(){return new n(this.y,-this.x)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},rotated:function(t){return n.createPolar(this.magnitude(),this.angle()+t)},blend:function(t,i){return this.plus(t.minus(this).times(i))},toString:function(){return"Vector2("+this.x+", "+this.y+")"},toVector3:function(){return new e.Vector3(this.x,this.y)},set:function(t,i){return this.x=t,this.y=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},subtractScalar:function(t){return this.x-=t,this.y-=t,this},componentMultiply:function(t){return this.x*=t.x,this.y*=t.y,this},divideScalar:function(t){return this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this}},n.Immutable=function(t,i){this.x=t||0,this.y=i||0};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector2")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0),n.X_UNIT=new s(1,0),n.Y_UNIT=new s(0,1),n}),e("DOT/Bounds2",["require","ASSERT/assert","DOT/dot","DOT/Vector2"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");t("DOT/Vector2"),e.Bounds2=function(t,e,n,s){i&&i(void 0!==s,"Bounds2 requires 4 parameters"),this.minX=t,this.minY=e,this.maxX=n,this.maxY=s};var n=e.Bounds2;return n.prototype={constructor:n,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getMinX:function(){return this.minX},getMinY:function(){return this.minY},getMaxX:function(){return this.maxX},getMaxY:function(){return this.maxY},isEmpty:function(){return 0>this.getWidth()||0>this.getHeight()},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,i){return t>=this.minX&&this.maxX>=t&&i>=this.minY&&this.maxY>=i},containsPoint:function(t){return this.containsCoordinates(t.x,t.y)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY},copy:function(){return new n(this.minX,this.minY,this.maxX,this.maxY)},union:function(t){return new n(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},intersection:function(t){return new n(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},withCoordinates:function(t,i){return new n(Math.min(this.minX,t),Math.min(this.minY,i),Math.max(this.maxX,t),Math.max(this.maxY,i))},withPoint:function(t){return this.withCoordinates(t.x,t.y)},withMinX:function(t){return new n(t,this.minY,this.maxX,this.maxY)},withMinY:function(t){return new n(this.minX,t,this.maxX,this.maxY)},withMaxX:function(t){return new n(this.minX,this.minY,t,this.maxY)},withMaxY:function(t){return new n(this.minX,this.minY,this.maxX,t)},roundedOut:function(){return new n(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundedIn:function(){return new n(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new n(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},eroded:function(t){return this.dilated(-t)},shiftedX:function(t){return new n(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftedY:function(t){return new n(this.minX,this.minY+t,this.maxX,this.maxY+t)},shifted:function(t,i){return new n(this.minX+t,this.minY+i,this.maxX+t,this.maxY+i)},set:function(t,i,e,n){return this.minX=t,this.minY=i,this.maxX=e,this.maxY=n,this},setBounds:function(t){return this.set(t.minX,t.minY,t.maxX,t.maxY)},includeBounds:function(t){return this.minX=Math.min(this.minX,t.minX),this.minY=Math.min(this.minY,t.minY),this.maxX=Math.max(this.maxX,t.maxX),this.maxY=Math.max(this.maxY,t.maxY),this},constrainBounds:function(t){return this.minX=Math.max(this.minX,t.minX),this.minY=Math.max(this.minY,t.minY),this.maxX=Math.min(this.maxX,t.maxX),this.maxY=Math.min(this.maxY,t.maxY),this},addCoordinates:function(t,i){return this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i),this},addPoint:function(t){return this.addCoordinates(t.x,t.y)},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},roundOut:function(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this},roundIn:function(){return this.minX=Math.ceil(this.minX),this.minY=Math.ceil(this.minY),this.maxX=Math.floor(this.maxX),this.maxY=Math.floor(this.maxY),this},transform:function(t){if(this.isEmpty())return this;var i=this.minX,s=this.minY,r=this.maxX,h=this.maxY,o=new e.Vector2;return this.setBounds(n.NOTHING),this.addPoint(t.multiplyVector2(o.set(i,s))),this.addPoint(t.multiplyVector2(o.set(i,h))),this.addPoint(t.multiplyVector2(o.set(r,s))),this.addPoint(t.multiplyVector2(o.set(r,h))),this},dilate:function(t){return this.set(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},erode:function(t){return this.dilate(-t)},shiftX:function(t){return this.setMinX(this.minX+t).setMaxX(this.maxX+t)},shiftY:function(t){return this.setMinY(this.minY+t).setMaxY(this.maxY+t)},shift:function(t,i){return this.shiftX(t).shiftY(i)}},n.EVERYTHING=new n(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n.NOTHING=new n(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),n}),e("DOT/Ray2",["require","ASSERT/assert","DOT/dot"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");e.Ray2=function(t,e){this.pos=t,this.dir=e,i&&i(.01>Math.abs(e.magnitude()-1))};var n=e.Ray2;return n.prototype={constructor:n,shifted:function(t){return new n(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return""+this.pos+" => "+(""+this.dir)}},n}),e("DOT/Vector4",["require","ASSERT/assert","DOT/dot","DOT/Util"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");t("DOT/Util"),e.Vector4=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1};var n=e.Vector4;n.prototype={constructor:n,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t,this.z/t,this.w/t)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},times:function(t){return i&&i(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},plusScalar:function(t){return new n(this.x+t,this.y+t,this.z+t,this.w+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},minusScalar:function(t){return new n(this.x-t,this.y-t,this.z-t,this.w-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t,this.z/t,this.w/t)},negated:function(){return new n(-this.x,-this.y,-this.z,-this.w)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,i){return this.plus(t.minus(this).times(i))},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},toVector3:function(){return new e.Vector3(this.x,this.y,this.z)},set:function(t,i,e,n){this.x=t,this.y=i,this.z=e,this.w=n},setX:function(t){this.x=t},setY:function(t){this.y=t},setZ:function(t){this.z=t},setW:function(t){this.w=t},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w},addScalar:function(t){this.x+=t,this.y+=t,this.z+=t,this.w+=t},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},subtractScalar:function(t){this.x-=t,this.y-=t,this.z-=t,this.w-=t},componentMultiply:function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w},divideScalar:function(t){this.x/=t,this.y/=t,this.z/=t,this.w/=t},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},equalsEpsilon:function(t,i){return i||(i=0),i>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)},isVector4:!0,dimension:4},n.Immutable=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector4")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("setZ"),s.mutableOverrideHelper("setW"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0,0,0),n.X_UNIT=new s(1,0,0,0),n.Y_UNIT=new s(0,1,0,0),n.Z_UNIT=new s(0,0,1,0),n.W_UNIT=new s(0,0,0,1),n}),e("DOT/Vector3",["require","ASSERT/assert","DOT/dot","DOT/Util","DOT/Vector2","DOT/Vector4"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");t("DOT/Util"),t("DOT/Vector2"),t("DOT/Vector4"),e.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0};var n=e.Vector3;n.prototype={constructor:n,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},cross:function(t){return new n(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t,this.z/t)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t)},times:function(t){return i&&i(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},plusScalar:function(t){return new n(this.x+t,this.y+t,this.z+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},minusScalar:function(t){return new n(this.x-t,this.y-t,this.z-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t,this.z/t)},negated:function(){return new n(-this.x,-this.y,-this.z)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,i){return this.plus(t.minus(this).times(i))},toString:function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"},toVector2:function(){return new e.Vector2(this.x,this.y)},toVector4:function(){return new e.Vector4(this.x,this.y,this.z)},set:function(t,i,e){this.x=t,this.y=i,this.z=e},setX:function(t){this.x=t},setY:function(t){this.y=t},setZ:function(t){this.z=t},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},addScalar:function(t){this.x+=t,this.y+=t,this.z+=t},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},subtractScalar:function(t){this.x-=t,this.y-=t,this.z-=t},componentMultiply:function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z},divideScalar:function(t){this.x/=t,this.y/=t,this.z/=t},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},equalsEpsilon:function(t,i){return i||(i=0),i>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},isVector3:!0,dimension:3},n.Immutable=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector3")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("setZ"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0,0),n.X_UNIT=new s(1,0,0),n.Y_UNIT=new s(0,1,0),n.Z_UNIT=new s(0,0,1),n}),e("DOT/Matrix4",["require","DOT/dot","DOT/Vector3","DOT/Vector4"],function(t){var i=t("DOT/dot");t("DOT/Vector3"),t("DOT/Vector4");var e=window.Float32Array||Array;i.Matrix4=function(t,i,n,s,r,h,o,a,m,u,c,d,l,f,p,T,g){this.entries=new e(16),this.rowMajor(void 0===t?1:t,i||0,n||0,s||0,r||0,void 0===h?1:h,o||0,a||0,m||0,u||0,void 0===c?1:c,d||0,l||0,f||0,p||0,void 0===T?1:T,g)};var n=i.Matrix4;n.Types={OTHER:0,IDENTITY:1,TRANSLATION_3D:2,SCALING:3};var s=n.Types;return n.identity=function(){return new n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,s.IDENTITY)},n.translation=function(t,i,e){return new n(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1,s.TRANSLATION_3D)},n.translationFromVector=function(t){return n.translation(t.x,t.y,t.z)},n.scaling=function(t,i,e){return i=void 0===i?t:i,e=void 0===e?t:e,new n(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1,s.SCALING)},n.rotationAxisAngle=function(t,i){var e=Math.cos(i),r=Math.sin(i),h=1-e;return new n(t.x*t.x*h+e,t.x*t.y*h-t.z*r,t.x*t.z*h+t.y*r,0,t.y*t.x*h+t.z*r,t.y*t.y*h+e,t.y*t.z*h-t.x*r,0,t.z*t.x*h-t.y*r,t.z*t.y*h+t.x*r,t.z*t.z*h+e,0,0,0,0,1,s.OTHER)},n.rotationX=function(t){var i=Math.cos(t),e=Math.sin(t);return new n(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1,s.OTHER)},n.rotationY=function(t){var i=Math.cos(t),e=Math.sin(t);return new n(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1,s.OTHER)},n.rotationZ=function(t){var i=Math.cos(t),e=Math.sin(t);return new n(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1,s.OTHER)},n.gluPerspective=function(t,i,e,s){var r=Math.cos(t)/Math.sin(t);return new n(r/i,0,0,0,0,r,0,0,0,0,(s+e)/(e-s),2*s*e/(e-s),0,0,-1,0)},n.prototype={constructor:n,rowMajor:function(t,i,e,n,r,h,o,a,m,u,c,d,l,f,p,T,g){this.entries[0]=t,this.entries[1]=r,this.entries[2]=m,this.entries[3]=l,this.entries[4]=i,this.entries[5]=h,this.entries[6]=u,this.entries[7]=f,this.entries[8]=e,this.entries[9]=o,this.entries[10]=c,this.entries[11]=p,this.entries[12]=n,this.entries[13]=a,this.entries[14]=d,this.entries[15]=T,this.type=void 0===g?s.OTHER:g},columnMajor:function(t,i,e,n,s,r,h,o,a,m,u,c,d,l,f,p,T){this.rowMajor(t,s,a,d,i,r,m,l,e,h,u,f,n,o,c,p,T)},m00:function(){return this.entries[0]},m01:function(){return this.entries[4]},m02:function(){return this.entries[8]},m03:function(){return this.entries[12]},m10:function(){return this.entries[1]},m11:function(){return this.entries[5]},m12:function(){return this.entries[9]},m13:function(){return this.entries[13]},m20:function(){return this.entries[2]},m21:function(){return this.entries[6]},m22:function(){return this.entries[10]},m23:function(){return this.entries[14]},m30:function(){return this.entries[3]},m31:function(){return this.entries[7]},m32:function(){return this.entries[11]},m33:function(){return this.entries[15]},plus:function(t){return new n(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())},minus:function(t){return new n(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())},transposed:function(){return new n(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())},negated:function(){return new n(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())},inverted:function(){var t=this.determinant();if(0!==t)return new n((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw Error("Matrix could not be inverted, determinant === 0")},timesMatrix:function(t){var i=s.OTHER;return this.type===s.TRANSLATION_3D&&t.type===s.TRANSLATION_3D&&(i=s.TRANSLATION_3D),this.type===s.SCALING&&t.type===s.SCALING&&(i=s.SCALING),this.type===s.IDENTITY&&(i=t.type),t.type===s.IDENTITY&&(i=this.type),new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33(),i)},timesVector4:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,r=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new i.Vector4(e,n,s,r)},timesVector3:function(t){return this.timesVector4(t.toVector4()).toVector3()},timesTransposeVector4:function(t){var e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,n=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,s=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,r=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new i.Vector4(e,n,s,r)},timesTransposeVector3:function(t){return this.timesTransposeVector4(t.toVector4()).toVector3()},timesRelativeVector3:function(t){var e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,n=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,s=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new i.Vector3(e,n,s)},determinant:function(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()
},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+" "+this.m03()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+" "+this.m13()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()+" "+this.m23()+"\n"+this.m30()+" "+this.m31()+" "+this.m32()+" "+this.m33()},translation:function(){return new i.Vector3(this.m03(),this.m13(),this.m23())},scaling:function(){return new i.Vector3(this.m00(),this.m11(),this.m22())},makeImmutable:function(){this.rowMajor=function(){throw Error("Cannot modify immutable matrix")}}},n.IDENTITY=new n,n.IDENTITY.makeImmutable(),n}),e("DOT/Matrix3",["require","DOT/dot","DOT/Vector2","DOT/Vector3","DOT/Matrix4"],function(t){var i=t("DOT/dot");t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Matrix4"),i.Matrix3=function(t,i,e,n,s,r,h,o,a,m){this.entries=Array(9),this.rowMajor(void 0===t?1:t,i||0,e||0,n||0,void 0===s?1:s,r||0,h||0,o||0,void 0===a?1:a,m)};var e=i.Matrix3;e.Types={OTHER:0,IDENTITY:1,TRANSLATION_2D:2,SCALING:3,AFFINE:4};var n=e.Types;return e.identity=function(){return new e(1,0,0,0,1,0,0,0,1,n.IDENTITY)},e.translation=function(t,i){return new e(1,0,t,0,1,i,0,0,1,n.TRANSLATION_2D)},e.translationFromVector=function(t){return e.translation(t.x,t.y)},e.scaling=function(t,i){return i=void 0===i?t:i,new e(t,0,0,0,i,0,0,0,1,n.SCALING)},e.scale=e.scaling,e.rotationAxisAngle=function(t,i){var s=Math.cos(i),r=Math.sin(i),h=1-s;return new e(t.x*t.x*h+s,t.x*t.y*h-t.z*r,t.x*t.z*h+t.y*r,t.y*t.x*h+t.z*r,t.y*t.y*h+s,t.y*t.z*h-t.x*r,t.z*t.x*h-t.y*r,t.z*t.y*h+t.x*r,t.z*t.z*h+s,n.OTHER)},e.rotationX=function(t){var i=Math.cos(t),s=Math.sin(t);return new e(1,0,0,0,i,-s,0,s,i,n.OTHER)},e.rotationY=function(t){var i=Math.cos(t),s=Math.sin(t);return new e(i,0,s,0,1,0,-s,0,i,n.OTHER)},e.rotationZ=function(t){var i=Math.cos(t),s=Math.sin(t);return new e(i,-s,0,s,i,0,0,0,1,n.AFFINE)},e.rotation2=e.rotationZ,e.fromSVGMatrix=function(t){return new e(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,n.AFFINE)},e.rotateAToB=function(t,n){var s,r,h,o=t,a=n,m=1e-4,u=o.cross(a);if(s=o.dot(a),h=0>s?-s:s,h>1-m){var c,d,l,f=new i.Vector3(o.x>0?o.x:-o.x,o.y>0?o.y:-o.y,o.z>0?o.z:-o.z);f=f.x<f.y?f.x<f.z?i.Vector3.X_UNIT:i.Vector3.Z_UNIT:f.y<f.z?i.Vector3.Y_UNIT:i.Vector3.Z_UNIT;var p=f.minus(o);return u=f.minus(a),c=2/p.dot(p),d=2/u.dot(u),l=c*d*p.dot(u),e.IDENTITY.plus(e.rowMajor(-c*p.x*p.x-d*u.x*u.x+l*u.x*p.x,-c*p.x*p.y-d*u.x*u.y+l*u.x*p.y,-c*p.x*p.z-d*u.x*u.z+l*u.x*p.z,-c*p.y*p.x-d*u.y*u.x+l*u.y*p.x,-c*p.y*p.y-d*u.y*u.y+l*u.y*p.y,-c*p.y*p.z-d*u.y*u.z+l*u.y*p.z,-c*p.z*p.x-d*u.z*u.x+l*u.z*p.x,-c*p.z*p.y-d*u.z*u.y+l*u.z*p.y,-c*p.z*p.z-d*u.z*u.z+l*u.z*p.z))}var T,g,x,v,y;return r=1/(1+s),T=r*u.x,g=r*u.z,x=T*u.y,v=T*u.z,y=g*u.y,e.rowMajor(s+T*u.x,x-u.z,v+u.y,x+u.z,s+r*u.y*u.y,y-u.x,v-u.y,y+u.x,s+g*u.z)},e.prototype={constructor:e,m00:function(){return this.entries[0]},m01:function(){return this.entries[3]},m02:function(){return this.entries[6]},m10:function(){return this.entries[1]},m11:function(){return this.entries[4]},m12:function(){return this.entries[7]},m20:function(){return this.entries[2]},m21:function(){return this.entries[5]},m22:function(){return this.entries[8]},isAffine:function(){return this.type===n.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()},getDeterminant:function(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()},get determinant(){return this.getDeterminant()},getTranslation:function(){return new i.Vector2(this.m02(),this.m12())},get translation(){return this.getTranslation()},getScaleVector:function(){return new i.Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))},get scaleVector(){return this.getScaleVector()},getRotation:function(){var t=this.timesVector2(i.Vector2.X_UNIT).minus(this.timesVector2(i.Vector2.ZERO));return Math.atan2(t.y,t.x)},get rotation(){return this.getRotation()},toMatrix4:function(){return new i.Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()},toSVGMatrix:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t},getCSSTransform:function(){function t(t){return t.toFixed(20)}return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"},get cssTransform(){return this.getCSSTransform()},getSVGTransform:function(){function t(t){return t.toFixed(20)}switch(this.type){case n.IDENTITY:return"";case n.TRANSLATION_2D:return"translate("+t(this.entries[6])+","+this.entries[7]+")";case n.SCALING:return"scale("+t(this.entries[0])+(this.entries[0]===this.entries[4]?"":","+t(this.entries[4]))+")";default:return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"}},get svgTransform(){return this.getSVGTransform()},getCSSTransformStyles:function(){var t=this.getCSSTransform();return{"-webkit-perspective":1e3,"-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}},get cssTransformStyles(){return this.getCSSTransformStyles()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()},equalsEpsilon:function(t,i){return i>Math.abs(this.m00()-t.m00())&&i>Math.abs(this.m01()-t.m01())&&i>Math.abs(this.m02()-t.m02())&&i>Math.abs(this.m10()-t.m10())&&i>Math.abs(this.m11()-t.m11())&&i>Math.abs(this.m12()-t.m12())&&i>Math.abs(this.m20()-t.m20())&&i>Math.abs(this.m21()-t.m21())&&i>Math.abs(this.m22()-t.m22())},copy:function(){return new e(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)},plus:function(t){return new e(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},minus:function(t){return new e(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transposed:function(){return new e(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===n.IDENTITY||this.type===n.SCALING?this.type:void 0)},negated:function(){return new e(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},inverted:function(){var t;switch(this.type){case n.IDENTITY:return this;case n.TRANSLATION_2D:return new e(1,0,-this.m02(),0,1,-this.m12(),0,0,1,n.TRANSLATION_2D);case n.SCALING:return new e(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),n.SCALING);case n.AFFINE:if(t=this.getDeterminant(),0!==t)return new e((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,n.AFFINE);throw Error("Matrix could not be inverted, determinant === 0");case n.OTHER:if(t=this.getDeterminant(),0!==t)return new e((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,n.OTHER);throw Error("Matrix could not be inverted, determinant === 0");default:throw Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===n.IDENTITY||t.type===n.IDENTITY)return this.type===n.IDENTITY?t:this;if(this.type===t.type){if(this.type===n.TRANSLATION_2D)return new e(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,n.TRANSLATION_2D);if(this.type===n.SCALING)return new e(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,n.SCALING)}return this.type!==n.OTHER&&t.type!==n.OTHER?new e(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,n.AFFINE):new e(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},timesVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02(),n=this.m10()*t.x+this.m11()*t.y+this.m12();return new i.Vector2(e,n)},timesVector3:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new i.Vector3(e,n,s)},timesTransposeVector2:function(t){var e=this.m00()*t.x+this.m10()*t.y,n=this.m01()*t.x+this.m11()*t.y;return new i.Vector2(e,n)},timesRelativeVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y,n=this.m10()*t.y+this.m11()*t.y;return new i.Vector2(e,n)},makeImmutable:function(){return this.rowMajor=function(){throw Error("Cannot modify immutable matrix")},this},rowMajor:function(t,i,e,s,r,h,o,a,m,u){return this.entries[0]=t,this.entries[1]=s,this.entries[2]=o,this.entries[3]=i,this.entries[4]=r,this.entries[5]=a,this.entries[6]=e,this.entries[7]=h,this.entries[8]=m,this.type=void 0===u?0===o&&0===a&&1===m?n.AFFINE:n.OTHER:u,this},columnMajor:function(t,i,e,n,s,r,h,o,a,m){return this.rowMajor(t,n,h,i,s,o,e,r,a,m)},add:function(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},subtract:function(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transpose:function(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===n.IDENTITY||this.type===n.SCALING?this.type:void 0)},negate:function(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},invert:function(){var t;switch(this.type){case n.IDENTITY:return this;case n.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,n.TRANSLATION_2D);case n.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),n.SCALING);case n.AFFINE:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,n.AFFINE);throw Error("Matrix could not be inverted, determinant === 0");case n.OTHER:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,n.OTHER);throw Error("Matrix could not be inverted, determinant === 0");default:throw Error("Matrix3.inverted with unknown type: "+this.type)}},multiplyMatrix:function(t){if(this.type===n.IDENTITY||t.type===n.IDENTITY)return this.type===n.IDENTITY?t:this;if(this.type===t.type){if(this.type===n.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,n.TRANSLATION_2D);if(this.type===n.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,n.SCALING)}return this.type!==n.OTHER&&t.type!==n.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,n.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},multiplyVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02(),e=this.m10()*t.x+this.m11()*t.y+this.m12();return t.setX(i),t.setY(e),t},multiplyVector3:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,e=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,n=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return t.setX(i),t.setY(e),t.setZ(n),t},multiplyTransposeVector2:function(t){var i=this.m00()*t.x+this.m10()*t.y,e=this.m01()*t.x+this.m11()*t.y;return t.setX(i),t.setY(e),t},multiplyRelativeVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y,e=this.m10()*t.y+this.m11()*t.y;return t.setX(i),t.setY(e),t},canvasSetTransform:function(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},canvasAppendTransform:function(t){t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}},e.IDENTITY=new e(1,0,0,0,1,0,0,0,1,n.IDENTITY),e.IDENTITY.makeImmutable(),e.X_REFLECTION=new e(-1,0,0,0,1,0,0,0,1,n.AFFINE),e.X_REFLECTION.makeImmutable(),e.Y_REFLECTION=new e(1,0,0,0,-1,0,0,0,1,n.AFFINE),e.Y_REFLECTION.makeImmutable(),e.printer={print:function(t){console.log(""+t)}},e}),e("DOT/Transform3",["require","ASSERT/assert","DOT/dot","DOT/Matrix3","DOT/Vector2","DOT/Ray2"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot");t("DOT/Matrix3"),t("DOT/Vector2"),t("DOT/Ray2"),e.Transform3=function(t){this.listeners=[],this.set(void 0===t?e.Matrix3.IDENTITY:t)};var n=e.Transform3;return n.prototype={constructor:n,set:function(t){i&&i(t instanceof e.Matrix3);var n,s=this.matrix,r=this.listeners.length;for(n=0;r>n;n++)this.listeners[n].before(t,s);for(this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null,n=0;r>n;n++)this.listeners[n].after(t,s)},prepend:function(t){this.set(t.timesMatrix(this.matrix))},append:function(t){this.set(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())},copy:function(){var t=new n(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed},deepCopy:function(){var t=new n(this.matrix.copy());t.inverse=this.inverse?this.inverse.copy():null,t.matrixTransposed=this.matrixTransposed?this.matrixTransposed.copy():null,t.inverseTransposed=this.inverseTransposed?this.inverseTransposed.copy():null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===e.Matrix3.Types.IDENTITY},transformPosition2:function(t){return this.matrix.timesVector2(t)},transformDelta2:function(t){return this.matrix.timesRelativeVector2(t)},transformNormal2:function(t){return this.getInverse().timesTransposeVector2(t)},transformDeltaX:function(t){return this.transformDelta2(new e.Vector2(t,0)).x},transformDeltaY:function(t){return this.transformDelta2(new e.Vector2(0,t)).y},transformBounds2:function(t){return t.transformed(this.matrix)},transformShape:function(t){return t.transformed(this.matrix)},transformRay2:function(t){return new e.Ray2(this.transformPosition2(t.pos),this.transformDelta2(t.dir).normalized())},inversePosition2:function(t){return this.getInverse().timesVector2(t)},inverseDelta2:function(t){return this.inversePosition2(t).minus(this.inversePosition2(e.Vector2.ZERO))},inverseNormal2:function(t){return this.matrix.timesTransposeVector2(t)},inverseDeltaX:function(t){return this.inverseDelta2(new e.Vector2(t,0)).x},inverseDeltaY:function(t){return this.inverseDelta2(new e.Vector2(0,t)).y},inverseBounds2:function(t){return t.transformed(this.getInverse())},inverseShape:function(t){return t.transformed(this.getInverse())},inverseRay2:function(t){return new e.Ray2(this.inversePosition2(t.pos),this.inverseDelta2(t.dir).normalized())},addTransformListener:function(t){i&&i(!_.contains(this.listeners,t)),this.listeners.push(t)},removeTransformListener:function(t){i&&i(_.contains(this.listeners,t)),this.listeners.splice(_.indexOf(this.listeners,t),1)}},n}),e("KITE/segments/Segment",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite");i.Segment={};var e=i.Segment;return e}),e("KITE/pieces/Piece",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite");i.Piece={};var e=i.Piece;return e}),e("KITE/segments/Line",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece"],function(t){t("ASSERT/assert")("kite"),t("KITE/kite");var i=t("DOT/Bounds2"),e=t("DOT/Util").lineLineIntersection,n=t("KITE/segments/Segment"),s=t("KITE/pieces/Piece");return n.Line=function(t,e){return this.start=t,this.end=e,t.equals(e,0)?(this.invalid=!0,void 0):(this.startTangent=e.minus(t).normalized(),this.endTangent=this.startTangent,this.bounds=i.NOTHING.withPoint(t).withPoint(e),void 0)},n.Line.prototype={constructor:n.Line,positionAt:function(t){return this.start.plus(this.end.minus(this.start).times(t))},tangentAt:function(){return this.startTangent},curvatureAt:function(){return 0},toPieces:function(){return[new s.LineTo(this.end)]},getSVGPathFragment:function(){return"L "+this.end.x+" "+this.end.y},strokeLeft:function(t){return[new s.LineTo(this.end.plus(this.endTangent.perpendicular().negated().times(t/2)))]},strokeRight:function(t){return[new s.LineTo(this.start.plus(this.startTangent.perpendicular().times(t/2)))]},intersectsBounds:function(){throw Error("Segment.Line.intersectsBounds unimplemented")},intersection:function(t){var i=[],n=this.start,s=this.end,r=e(n,s,t.pos,t.pos.plus(t.dir));if(!isFinite(r.x)||!isFinite(r.y))return i;if(n.x!==s.x&&(n.x>s.x?r.x>=n.x||r.x<s.x:r.x<=n.x||r.x>s.x))return i;if(n.y!==s.y&&(n.y>s.y?r.y>=n.y||r.y<s.y:r.y<=n.y||r.y>s.y))return i;var h=r.minus(t.pos).dot(t.dir);if(0>h)return i;var o=s.minus(n),a=o.perpendicular();return i.push({distance:h,point:t.pointAtDistance(h),normal:a.dot(t.dir)>0?a.negated():a,wind:0>t.dir.perpendicular().dot(o)?1:-1}),i},windingIntersection:function(t){var i=this.intersection(t);return i.length?i[0].wind:0}},n.Line}),e("KITE/util/Subpath",["require","ASSERT/assert","KITE/kite","KITE/segments/Line"],function(t){var i=t("ASSERT/assert")("kite"),e=t("KITE/kite");t("KITE/segments/Line"),e.Subpath=function(){this.points=[],this.segments=[],this.closed=!1};var n=e.Subpath;return n.prototype={addPoint:function(t){this.points.push(t)},addSegment:function(t){t.invalid||(i&&i(t.start.isFinite(),"Segment start is infinite"),i&&i(t.end.isFinite(),"Segment end is infinite"),i&&i(t.startTangent.isFinite(),"Segment startTangent is infinite"),i&&i(t.endTangent.isFinite(),"Segment endTangent is infinite"),i&&i(t.bounds.isEmpty()||t.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(t))},close:function(){this.closed=!0},getLength:function(){return this.points.length},getFirstPoint:function(){return _.first(this.points)},getLastPoint:function(){return _.last(this.points)},getFirstSegment:function(){return _.first(this.segments)},getLastSegment:function(){return _.last(this.segments)},isDrawable:function(){return this.segments.length>0},isClosed:function(){return this.closed},hasClosingSegment:function(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)},getClosingSegment:function(){return i&&i(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new e.Segment.Line(this.getLastPoint(),this.getFirstPoint())}},e.Subpath}),e("KITE/util/LineStyles",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite");i.LineStyles=function(t){void 0===t&&(t={}),this.lineWidth=void 0!==t.lineWidth?t.lineWidth:1,this.lineCap=void 0!==t.lineCap?t.lineCap:"butt",this.lineJoin=void 0!==t.lineJoin?t.lineJoin:"miter",this.lineDash=void 0!==t.lineDash?t.lineDash:null,this.miterLimit=void 0!==t.miterLimit?t.miterLimit:10};var e=i.LineStyles;return e.prototype={constructor:e,equals:function(t){var i=this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit;if(!i)return!1;if(!this.lineDash!=!t.lineDash)return!1;if(this.lineDash){if(this.lineDash.length!==t.lineDash.length)return!1;for(var e=0;this.lineDash.length>e;e++)if(this.lineDash[e]!==t.lineDash[e])return!1;return!0}return!0}},i.LineStyles}),e("KITE/segments/EllipticalArc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Matrix3","DOT/Transform3","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece","KITE/util/Subpath"],function(t){var i=t("ASSERT/assert")("kite");t("KITE/kite");var e=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("DOT/Matrix3"),r=t("DOT/Transform3"),h=t("DOT/Util").toDegrees,o=t("KITE/segments/Segment"),a=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),o.EllipticalArc=function(t,e,s,r,h,a,m){function u(t){c.containsAngle(t)&&(c.bounds=c.bounds.withPoint(c.positionAtAngle(t)))}if(this.center=t,this.radiusX=e,this.radiusY=s,this.rotation=r,this.startAngle=h,this.endAngle=a,this.anticlockwise=m,this.unitTransform=o.EllipticalArc.computeUnitTransform(t,e,s,r),this.start=this.positionAtAngle(h),this.end=this.positionAtAngle(a),this.startTangent=this.tangentAtAngle(h).normalized(),this.endTangent=this.tangentAtAngle(a).normalized(),0===e||0===s||h===a)return this.invalid=!0,void 0;if(s>e)throw Error("Not verified to work if radiusX < radiusY");i&&i(!(!m&&2*-Math.PI>=a-h||m&&2*-Math.PI>=h-a),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),i&&i(!(!m&&a-h>2*Math.PI||m&&h-a>2*Math.PI),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),!m&&a-h>=2*Math.PI||m&&h-a>=2*Math.PI,this.angleDifference=this.anticlockwise?this.startAngle-this.endAngle:this.endAngle-this.startAngle,0>this.angleDifference&&(this.angleDifference+=2*Math.PI),i&&i(this.angleDifference>=0),this.unitArcSegment=new o.Arc(t,1,h,a,m),this.bounds=n.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var c=this;if(h!==a){var d=Math.atan(-(s/e)*Math.tan(r)),l=Math.atan(s/e/Math.tan(r));u(d),u(d+Math.PI),u(l),u(l+Math.PI)}},o.EllipticalArc.prototype={constructor:o.EllipticalArc,angleAt:function(t){return this.anticlockwise?this.startAngle>this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle<this.endAngle?this.startAngle+(2*-Math.PI+this.endAngle-this.startAngle)*t:this.startAngle:this.startAngle<this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle>this.endAngle?this.startAngle+(2*Math.PI+this.endAngle-this.startAngle)*t:this.startAngle},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){var i=this.angleAt(t),e=this.radiusX*Math.sin(i),n=this.radiusY*Math.cos(i),s=Math.pow(n*n+e*e,1.5);return(this.anticlockwise?-1:1)*this.radiusX*this.radiusY/s},positionAtAngle:function(t){return this.unitTransform.transformPosition2(e.createPolar(1,t))},tangentAtAngle:function(t){var i=this.unitTransform.transformNormal2(e.createPolar(1,t));return this.anticlockwise?i.perpendicular():i.perpendicular().negated()},containsAngle:function(t){var i=this.anticlockwise?t-this.endAngle:t-this.startAngle,e=i%(2*Math.PI);return 0>e&&(e+=2*Math.PI),this.angleDifference>=e},toPieces:function(){return[new a.EllipticalArc(this.center,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise)]},offsetTo:function(t,i){for(var e=32,n=[],s=1;e>s;s++){var r=s/(e-1);i&&(r=1-r);var h=this.angleAt(r),o=this.positionAtAngle(h).plus(this.tangentAtAngle(h).perpendicular().normalized().times(t));n.push(new a.LineTo(o))}return n},getSVGPathFragment:function(){var t,i=.01,e=this.anticlockwise?"0":"1",n=h(this.rotation);if(this.angleDifference<2*Math.PI-i)return t=this.angleDifference<Math.PI?"0":"1","A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+e+" "+this.end.x+" "+this.end.y;var s=(this.startAngle+this.endAngle)/2,r=this.positionAtAngle(s);t="0";var o="A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+e+" "+r.x+" "+r.y,a="A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+e+" "+this.end.x+" "+this.end.y;return o+" "+a},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.EllipticalArc.intersectsBounds unimplemented")},intersection:function(t){var i=this.unitTransform,e=i.inverseRay2(t),n=this.unitArcSegment.intersection(e);return _.map(n,function(e){var n=i.transformPosition2(e.point);return{distance:t.pos.distance(n),point:n,normal:i.inverseNormal2(e.normal),wind:e.wind}})},windingIntersection:function(t){var i=this.unitTransform.inverseRay2(t);return this.unitArcSegment.windingIntersection(i)}},o.EllipticalArc.computeUnitTransform=function(t,i,e,n){return new r(s.translation(t.x,t.y).timesMatrix(s.rotation2(n)).timesMatrix(s.scaling(i,e)))},o.EllipticalArc}),e("KITE/pieces/EllipticalArc",["require","ASSERT/assert","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","DOT/Matrix3","DOT/Transform3","KITE/pieces/Piece","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite"),t("ASSERT/assert")("kite.extra",!0);var i=t("KITE/kite"),e=t("DOT/Vector2");t("DOT/Bounds2"),t("DOT/Ray2"),t("DOT/Matrix3"),t("DOT/Transform3");var n=t("KITE/pieces/Piece");return t("KITE/segments/EllipticalArc"),t("KITE/segments/Line"),t("KITE/util/Subpath"),n.EllipticalArc=function(t,e,n,s,r,h,o){if(0>e&&(e=-e,r=Math.PI-r,h=Math.PI-h,o=!o),0>n&&(n=-n,r=-r,h=-h,o=!o),n>e){s+=Math.PI/2,r-=Math.PI/2,h-=Math.PI/2;var a=e;e=n,n=a}this.center=t,this.radiusX=e,this.radiusY=n,this.rotation=s,this.startAngle=r,this.endAngle=h,this.anticlockwise=o,this.unitTransform=i.Segment.EllipticalArc.computeUnitTransform(t,e,n,s)},n.EllipticalArc.prototype={constructor:n.EllipticalArc,writeToContext:function(t){t.ellipse?t.ellipse(this.center.x,this.center.y,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise):(this.unitTransform.getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this.startAngle,this.endAngle,this.anticlockwise),this.unitTransform.getInverse().canvasAppendTransform(t))},transformed:function(t){var i=t.timesVector2(e.createPolar(this.radiusX,this.rotation)).minus(t.timesVector2(e.ZERO)),s=t.timesVector2(e.createPolar(this.radiusY,this.rotation+Math.PI/2)).minus(t.timesVector2(e.ZERO)),r=i.angle(),h=i.magnitude(),o=s.magnitude(),a=0>t.getDeterminant(),m=a?!this.anticlockwise:this.anticlockwise,u=a?-this.startAngle:this.startAngle,c=a?-this.endAngle:this.endAngle;return[new n.EllipticalArc(t.timesVector2(this.center),h,o,r,u,c,m)]},applyPiece:function(t){var e=new i.Segment.EllipticalArc(this.center,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise),n=e.start,s=e.end;t.hasSubpaths()&&t.getLastSubpath().getLength()>0&&!n.equals(t.getLastSubpath().getLastPoint(),0)&&t.getLastSubpath().addSegment(new i.Segment.Line(t.getLastSubpath().getLastPoint(),n)),t.hasSubpaths()||t.addSubpath(new i.Subpath),t.getLastSubpath().addSegment(e),t.getLastSubpath().addPoint(n),t.getLastSubpath().addPoint(s),e.invalid||(t.bounds=t.bounds.union(e.bounds))}},n.EllipticalArc}),e("KITE/segments/Arc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","KITE/segments/Segment","KITE/pieces/Piece"],function(t){var i=t("ASSERT/assert")("kite");t("KITE/kite");var e=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("KITE/segments/Segment"),r=t("KITE/pieces/Piece");return s.Arc=function(t,s,r,h,o){function a(i){m.containsAngle(i)&&(m.bounds=m.bounds.withPoint(t.plus(e.createPolar(s,i))))}if(this.center=t,this.radius=s,this.startAngle=r,this.endAngle=h,this.anticlockwise=o,this.start=this.positionAtAngle(r),this.end=this.positionAtAngle(h),this.startTangent=this.tangentAtAngle(r),this.endTangent=this.tangentAtAngle(h),0>=s||r===h)return this.invalid=!0,void 0;i&&i(!(!o&&2*-Math.PI>=h-r||o&&2*-Math.PI>=r-h),"Not handling arcs with start/end angles that show differences in-between browser handling"),i&&i(!(!o&&h-r>2*Math.PI||o&&r-h>2*Math.PI),"Not handling arcs with start/end angles that show differences in-between browser handling"),!o&&h-r>=2*Math.PI||o&&r-h>=2*Math.PI,this.angleDifference=this.anticlockwise?this.startAngle-this.endAngle:this.endAngle-this.startAngle,0>this.angleDifference&&(this.angleDifference+=2*Math.PI),i&&i(this.angleDifference>=0),this.bounds=n.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var m=this;r!==h&&(a(0),a(Math.PI/2),a(Math.PI),a(3*Math.PI/2))},s.Arc.prototype={constructor:s.Arc,angleAt:function(t){return this.anticlockwise?this.startAngle>this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle<this.endAngle?this.startAngle+(2*-Math.PI+this.endAngle-this.startAngle)*t:this.startAngle:this.startAngle<this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle>this.endAngle?this.startAngle+(2*Math.PI+this.endAngle-this.startAngle)*t:this.startAngle},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(){return(this.anticlockwise?-1:1)/this.radius
},positionAtAngle:function(t){return this.center.plus(e.createPolar(this.radius,t))},tangentAtAngle:function(t){var i=e.createPolar(1,t);return this.anticlockwise?i.perpendicular():i.perpendicular().negated()},containsAngle:function(t){var i=this.anticlockwise?t-this.endAngle:t-this.startAngle,e=i%(2*Math.PI);return 0>e&&(e+=2*Math.PI),this.angleDifference>=e},toPieces:function(){return[new r.Arc(this.center,this.radius,this.startAngle,this.endAngle,this.anticlockwise)]},getSVGPathFragment:function(){var t,i=.01,n=this.anticlockwise?"0":"1";if(this.angleDifference<2*Math.PI-i)return t=this.angleDifference<Math.PI?"0":"1","A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+this.end.x+" "+this.end.y;var s=(this.startAngle+this.endAngle)/2,r=this.center.plus(e.createPolar(this.radius,s));t="0";var h="A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+r.x+" "+r.y,o="A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+this.end.x+" "+this.end.y;return h+" "+o},strokeLeft:function(t){return[new r.Arc(this.center,this.radius+(this.anticlockwise?1:-1)*t/2,this.startAngle,this.endAngle,this.anticlockwise)]},strokeRight:function(t){return[new r.Arc(this.center,this.radius+(this.anticlockwise?-1:1)*t/2,this.endAngle,this.startAngle,!this.anticlockwise)]},intersectsBounds:function(){throw Error("Segment.intersectsBounds unimplemented!")},intersection:function(t){var i=[],e=0,n=t.pos.minus(this.center),s=t.dir.dot(n),r=n.magnitudeSquared(),h=4*s*s-4*(r-this.radius*this.radius);if(e>h)return i;var o=t.dir.dot(this.center)-t.dir.dot(t.pos),a=Math.sqrt(h)/2,m=o-a,u=o+a;if(e>u)return i;var c=t.pointAtDistance(u),d=c.minus(this.center).normalized();if(e>m)this.containsAngle(d.angle())&&i.push({distance:u,point:c,normal:d.negated(),wind:this.anticlockwise?-1:1});else{var l=t.pointAtDistance(m),f=l.minus(this.center).normalized();this.containsAngle(f.angle())&&i.push({distance:m,point:l,normal:f,wind:this.anticlockwise?1:-1}),this.containsAngle(d.angle())&&i.push({distance:u,point:c,normal:d.negated(),wind:this.anticlockwise?-1:1})}return i},windingIntersection:function(t){var i=0,e=this.intersection(t);return _.each(e,function(t){i+=t.wind}),i}},s.Arc}),e("KITE/pieces/Arc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","KITE/pieces/Piece","KITE/pieces/EllipticalArc","KITE/segments/Line","KITE/segments/Arc","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite"),e=t("DOT/Vector2"),n=t("KITE/pieces/Piece");return t("KITE/pieces/EllipticalArc"),t("KITE/segments/Line"),t("KITE/segments/Arc"),t("KITE/util/Subpath"),n.Arc=function(t,i,e,n,s){0>i&&(i=-i,e+=Math.PI,n+=Math.PI),this.center=t,this.radius=i,this.startAngle=e,this.endAngle=n,this.anticlockwise=s},n.Arc.prototype={constructor:n.Arc,writeToContext:function(t){t.arc(this.center.x,this.center.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},transformed:function(t){var i=t.timesVector2(e.createPolar(1,this.startAngle)).minus(t.timesVector2(e.ZERO)).angle(),s=t.timesVector2(e.createPolar(1,this.endAngle)).minus(t.timesVector2(e.ZERO)).angle(),r=t.getDeterminant()>=0?this.anticlockwise:!this.anticlockwise,h=t.getScaleVector();if(h.x!==h.y){var o=h.x*this.radius,a=h.y*this.radius;return[new n.EllipticalArc(t.timesVector2(this.center),o,a,0,i,s,r)]}var m=h.x*this.radius;return[new n.Arc(t.timesVector2(this.center),m,i,s,r)]},applyPiece:function(t){var e=new i.Segment.Arc(this.center,this.radius,this.startAngle,this.endAngle,this.anticlockwise),n=e.start,s=e.end;t.hasSubpaths()&&t.getLastSubpath().getLength()>0&&!n.equals(t.getLastSubpath().getLastPoint(),0)&&t.getLastSubpath().addSegment(new i.Segment.Line(t.getLastSubpath().getLastPoint(),n)),t.hasSubpaths()||t.addSubpath(new i.Subpath),t.getLastSubpath().addSegment(e),t.getLastSubpath().addPoint(n),t.getLastSubpath().addPoint(s),e.invalid||(t.bounds=t.bounds.union(e.bounds))}},n.Arc}),e("KITE/pieces/Close",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite"),e=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),e.Close=function(){},e.Close.prototype={constructor:e.Close,writeToContext:function(t){t.closePath()},transformed:function(){return[this]},applyPiece:function(t){if(t.hasSubpaths()){var e=t.getLastSubpath(),n=new i.Subpath;e.close(),t.addSubpath(n),n.addPoint(e.getFirstPoint())}}},e.Close}),e("KITE/segments/Quadratic",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Matrix3","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece"],function(t){var i=t("ASSERT/assert")("kite");t("KITE/kite");var e=t("DOT/Bounds2"),n=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,r=t("KITE/segments/Segment"),h=t("KITE/pieces/Piece");return r.Quadratic=function(t,n,s,r){if(this.start=t,this.control=n,this.end=s,t.equals(s,0)&&t.equals(n,0))return this.invalid=!0,void 0;var h;if(!r){var o=t.equals(n),a=s.equals(n);i&&i(!o||!a),this.startTangent=o?s.minus(t).normalized():n.minus(t).normalized(),this.endTangent=a?s.minus(t).normalized():s.minus(n).normalized(),this.bounds=new e(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.max(t.x,s.x),Math.max(t.y,s.y));var m=2*(s.x-2*n.x+t.x);0!==m&&(h=-2*(n.x-t.x)/m,h>0&&1>h&&(this.bounds=this.bounds.withPoint(this.positionAt(h))));var u=2*(s.y-2*n.y+t.y);0!==u&&(h=-2*(n.y-t.y)/u,h>0&&1>h&&(this.bounds=this.bounds.withPoint(this.positionAt(h))))}},r.Quadratic.prototype={constructor:r.Quadratic,degree:2,positionAt:function(t){var i=1-t;return this.start.times(i*i).plus(this.control.times(2*i*t)).plus(this.end.times(t*t))},tangentAt:function(t){return this.control.minus(this.start).times(2*(1-t)).plus(this.end.minus(this.control).times(2*t))},curvatureAt:function(t){var i=1e-7;if(Math.abs(t-.5)>.5-i){var e=.5>t,n=e?this.start:this.end,s=this.control,r=e?this.end:this.start,h=s.minus(n),o=h.magnitude(),a=(e?-1:1)*h.perpendicular().normalized().dot(r.minus(s));return a*(this.degree-1)/(this.degree*o*o)}return this.subdivided(t,!0)[0].curvatureAt(1)},offsetTo:function(t,i){for(var e=[this],n=5,s=0;n>s;s++)e=_.flatten(_.map(e,function(t){return t.subdivided(.5,!0)}));var r=_.map(e,function(i){return i.approximateOffset(t)});i&&(r.reverse(),r=_.map(r,function(t){return t.reversed(!0)}));var o=_.map(r,function(t){return new h.QuadraticCurveTo(t.control,t.end)});return o},subdivided:function(t,i){var e=this.start.blend(this.control,t),n=this.control.blend(this.end,t),s=e.blend(n,t);return[new r.Quadratic(this.start,e,s,i),new r.Quadratic(s,n,this.end,i)]},reversed:function(){return new r.Quadratic(this.end,this.control,this.start)},approximateOffset:function(t){return new r.Quadratic(this.start.plus((this.start.equals(this.control)?this.end.minus(this.start):this.control.minus(this.start)).perpendicular().normalized().times(t)),this.control.plus(this.end.minus(this.start).perpendicular().normalized().times(t)),this.end.plus((this.end.equals(this.control)?this.end.minus(this.start):this.end.minus(this.control)).perpendicular().normalized().times(t)))},toPieces:function(){return[new h.QuadraticCurveTo(this.control,this.end)]},getSVGPathFragment:function(){return"Q "+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.Quadratic.intersectsBounds unimplemented")},intersection:function(t){var i=this,e=[],r=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),h=r.timesVector2(this.start),o=r.timesVector2(this.control),a=r.timesVector2(this.end),m=h.y-2*o.y+a.y,u=-2*h.y+2*o.y,c=h.y,d=s(m,u,c);return _.each(d,function(n){if(n>=0&&1>=n){var s=i.positionAt(n),r=i.tangentAt(n).normalized(),h=r.perpendicular(),o=s.minus(t.pos);o.dot(t.dir)>0&&e.push({distance:o.magnitude(),point:s,normal:h.dot(t.dir)>0?h.negated():h,wind:0>t.dir.perpendicular().dot(r)?1:-1})}}),e},windingIntersection:function(t){var i=0,e=this.intersection(t);return _.each(e,function(t){i+=t.wind}),i}},r.Quadratic}),e("KITE/segments/Cubic",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Vector2","DOT/Matrix3","DOT/Util","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece","KITE/segments/Quadratic"],function(t){t("ASSERT/assert")("kite"),t("KITE/kite");var i=t("DOT/Bounds2"),e=t("DOT/Vector2"),n=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,r=t("DOT/Util").solveCubicRootsReal,h=t("KITE/segments/Segment"),o=t("KITE/pieces/Piece");return t("KITE/segments/Quadratic"),h.Cubic=function(t,e,n,r,o){function a(t,i,e,n){var r=-3*t+9*i-9*e+3*n,h=6*t-12*i+6*e,o=-3*t+3*i;return s(r,h,o)}if(this.start=t,this.control1=e,this.control2=n,this.end=r,!o){if(this.startTangent=this.tangentAt(0).normalized(),this.endTangent=this.tangentAt(1).normalized(),t.equals(r,0)&&t.equals(e,0)&&t.equals(n,0))return this.invalid=!0,void 0;this.r=e.minus(t).normalized(),this.s=this.r.perpendicular();var m=t.times(-1).plus(e.times(3)).plus(n.times(-3)).plus(r),u=t.times(3).plus(e.times(-6)).plus(n.times(3)),c=t.times(-3).plus(e.times(3)),d=m.perpendicular(),l=u.perpendicular(),f=d.dot(u);if(this.tCusp=-.5*(d.dot(c)/f),this.tDeterminant=this.tCusp*this.tCusp-1/3*(l.dot(c)/f),this.tDeterminant>=0){var p=Math.sqrt(this.tDeterminant);this.tInflection1=this.tCusp-p,this.tInflection2=this.tCusp+p}if(this.hasCusp()){var T=this.subdivided(this.tCusp,!0);this.startQuadratic=new h.Quadratic(T[0].start,T[0].control1,T[0].end,!1),this.endQuadratic=new h.Quadratic(T[1].start,T[1].control2,T[1].end,!1)}this.bounds=i.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var g=this;_.each(a(this.start.x,this.control1.x,this.control2.x,this.end.x),function(t){t>=0&&1>=t&&(g.bounds=g.bounds.withPoint(g.positionAt(t)))}),_.each(a(this.start.y,this.control1.y,this.control2.y,this.end.y),function(t){t>=0&&1>=t&&(g.bounds=g.bounds.withPoint(g.positionAt(t)))}),this.hasCusp()&&(this.bounds=this.bounds.withPoint(this.positionAt(this.tCusp)))}},h.Cubic.prototype={constructor:h.Cubic,degree:3,hasCusp:function(){var t=1e-6;return t>this.tangentAt(this.tCusp).magnitude()&&this.tCusp>=0&&1>=this.tCusp},positionAt:function(t){var i=1-t;return this.start.times(i*i*i).plus(this.control1.times(3*i*i*t)).plus(this.control2.times(3*i*t*t)).plus(this.end.times(t*t*t))},tangentAt:function(t){var i=1-t;return this.start.times(-3*i*i).plus(this.control1.times(3*i*i-6*i*t)).plus(this.control2.times(6*i*t-3*t*t)).plus(this.end.times(3*t*t))},curvatureAt:function(t){var i=1e-7;if(Math.abs(t-.5)>.5-i){var e=.5>t,n=e?this.start:this.end,s=e?this.control1:this.control2,r=e?this.control2:this.control1,h=s.minus(n),o=h.magnitude(),a=(e?-1:1)*h.perpendicular().normalized().dot(r.minus(s));return a*(this.degree-1)/(this.degree*o*o)}return this.subdivided(t,!0)[0].curvatureAt(1)},toRS:function(t){var i=t.minus(this.start);return new e(i.dot(this.r),i.dot(this.s))},subdivided:function(t,i){var e=this.start.blend(this.control1,t),n=this.control2.blend(this.end,t),s=this.control1.blend(this.control2,t),r=e.blend(s,t),o=s.blend(n,t),a=r.blend(o,t);return[new h.Cubic(this.start,e,r,a,i),new h.Cubic(a,o,n,this.end,i)]},offsetTo:function(t,i){for(var e=32,n=[],s=1;e>s;s++){var r=s/(e-1);i&&(r=1-r);var h=this.positionAt(r).plus(this.tangentAt(r).perpendicular().normalized().times(t));n.push(new o.LineTo(h))}return n},toPieces:function(){return[new o.CubicCurveTo(this.control1,this.control2,this.end)]},getSVGPathFragment:function(){return"C "+this.control1.x+" "+this.control1.y+" "+this.control2.x+" "+this.control2.y+" "+this.end.x+" "+this.end.y},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.Cubic.intersectsBounds unimplemented")},intersection:function(t){var i=this,e=[],s=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),h=s.timesVector2(this.start),o=s.timesVector2(this.control1),a=s.timesVector2(this.control2),m=s.timesVector2(this.end),u=-h.y+3*o.y-3*a.y+m.y,c=3*h.y-6*o.y+3*a.y,d=-3*h.y+3*o.y,l=h.y,f=r(u,c,d,l);return _.each(f,function(n){if(n>=0&&1>=n){var s=i.positionAt(n),r=i.tangentAt(n).normalized(),h=r.perpendicular(),o=s.minus(t.pos);o.dot(t.dir)>0&&e.push({distance:o.magnitude(),point:s,normal:h.dot(t.dir)>0?h.negated():h,wind:0>t.dir.perpendicular().dot(r)?1:-1})}}),e},windingIntersection:function(t){var i=0,e=this.intersection(t);return _.each(e,function(t){i+=t.wind}),i}},h.Cubic}),e("KITE/pieces/CubicCurveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Cubic"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite"),e=t("KITE/pieces/Piece");return t("KITE/segments/Cubic"),e.CubicCurveTo=function(t,i,e){this.control1=t,this.control2=i,this.point=e},e.CubicCurveTo.prototype={constructor:e.CubicCurveTo,writeToContext:function(t){t.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.point.x,this.point.y)},transformed:function(t){return[new e.CubicCurveTo(t.timesVector2(this.control1),t.timesVector2(this.control2),t.timesVector2(this.point))]},applyPiece:function(t){t.ensure(this.controlPoint);var e=t.getLastSubpath().getLastPoint(),n=new i.Segment.Cubic(e,this.control1,this.control2,this.point);n.hasCusp()?(t.getLastSubpath().addSegment(n.startQuadratic),t.getLastSubpath().addSegment(n.endQuadratic)):t.getLastSubpath().addSegment(n),t.getLastSubpath().addPoint(this.point),n.invalid||(t.bounds=t.bounds.union(n.bounds))}},e.CubicCurveTo}),e("KITE/pieces/LineTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Line"],function(t){var i=t("ASSERT/assert")("kite"),e=t("KITE/kite"),n=t("KITE/pieces/Piece");return t("KITE/segments/Line"),n.LineTo=function(t){this.point=t},n.LineTo.prototype={constructor:n.LineTo,writeToContext:function(t){t.lineTo(this.point.x,this.point.y)},transformed:function(t){return[new n.LineTo(t.timesVector2(this.point))]},applyPiece:function(t){if(t.hasSubpaths()){var n=t.getLastSubpath().getLastPoint(),s=this.point,r=new e.Segment.Line(n,s);t.getLastSubpath().addSegment(r),t.getLastSubpath().addPoint(s),t.bounds=t.bounds.withPoint(n).withPoint(s),i&&i(!isNaN(t.bounds.getX()))}else t.ensure(this.point)}},n.LineTo}),e("KITE/pieces/MoveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite"),e=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),e.MoveTo=function(t){this.point=t},e.MoveTo.prototype={constructor:e.MoveTo,writeToContext:function(t){t.moveTo(this.point.x,this.point.y)},transformed:function(t){return[new e.MoveTo(t.timesVector2(this.point))]},applyPiece:function(t){var e=new i.Subpath;e.addPoint(this.point),t.addSubpath(e)}},e.MoveTo}),e("KITE/pieces/QuadraticCurveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Quadratic"],function(t){t("ASSERT/assert")("kite");var i=t("KITE/kite"),e=t("KITE/pieces/Piece");return t("KITE/segments/Quadratic"),e.QuadraticCurveTo=function(t,i){this.controlPoint=t,this.point=i},e.QuadraticCurveTo.prototype={constructor:e.QuadraticCurveTo,writeToContext:function(t){t.quadraticCurveTo(this.controlPoint.x,this.controlPoint.y,this.point.x,this.point.y)},transformed:function(t){return[new e.QuadraticCurveTo(t.timesVector2(this.controlPoint),t.timesVector2(this.point))]},applyPiece:function(t){t.ensure(this.controlPoint);var e=t.getLastSubpath().getLastPoint(),n=new i.Segment.Quadratic(e,this.controlPoint,this.point);t.getLastSubpath().addSegment(n),t.getLastSubpath().addPoint(this.point),n.invalid||(t.bounds=t.bounds.union(n.bounds))}},e.QuadraticCurveTo}),e("KITE/pieces/Rect",["require","ASSERT/assert","KITE/kite","DOT/Vector2","KITE/pieces/Piece","KITE/pieces/MoveTo","KITE/pieces/Close","KITE/util/Subpath","KITE/segments/Line"],function(t){function i(t,i){return new s(t,i)}var e=t("ASSERT/assert")("kite"),n=t("KITE/kite"),s=t("DOT/Vector2"),r=t("KITE/pieces/Piece");return t("KITE/pieces/MoveTo"),t("KITE/pieces/Close"),t("KITE/util/Subpath"),t("KITE/segments/Line"),r.Rect=function(t,i,n,s){e&&e(void 0!==t&&void 0!==i&&void 0!==n&&void 0!==s,"Undefined argument for Piece.Rect"),this.x=t,this.y=i,this.width=n,this.height=s},r.Rect.prototype={constructor:r.Rect,writeToContext:function(t){t.rect(this.x,this.y,this.width,this.height)},transformed:function(t){var e=t.timesVector2(i(this.x,this.y)),n=t.timesVector2(i(this.x+this.width,this.y)),s=t.timesVector2(i(this.x+this.width,this.y+this.height)),h=t.timesVector2(i(this.x,this.y+this.height));return[new r.MoveTo(e),new r.LineTo(n),new r.LineTo(s),new r.LineTo(h),new r.Close,new r.MoveTo(e)]},applyPiece:function(t){var s=new n.Subpath;t.addSubpath(s),s.addPoint(i(this.x,this.y)),s.addPoint(i(this.x+this.width,this.y)),s.addPoint(i(this.x+this.width,this.y+this.height)),s.addPoint(i(this.x,this.y+this.height)),s.addSegment(new n.Segment.Line(s.points[0],s.points[1])),s.addSegment(new n.Segment.Line(s.points[1],s.points[2])),s.addSegment(new n.Segment.Line(s.points[2],s.points[3])),s.close(),t.addSubpath(new n.Subpath),t.getLastSubpath().addPoint(i(this.x,this.y)),t.bounds=t.bounds.withCoordinates(this.x,this.y).withCoordinates(this.x+this.width,this.y+this.height),e&&e(!isNaN(t.bounds.getX()))}},r.Rect}),e("KITE/Shape",["require","ASSERT/assert","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","DOT/Matrix3","DOT/Transform3","DOT/Util","DOT/Util","KITE/util/Subpath","KITE/pieces/Piece","KITE/util/LineStyles","KITE/pieces/Arc","KITE/pieces/Close","KITE/pieces/CubicCurveTo","KITE/pieces/EllipticalArc","KITE/pieces/LineTo","KITE/pieces/MoveTo","KITE/pieces/QuadraticCurveTo","KITE/pieces/Rect","KITE/segments/Line"],function(t){function i(t,i){return new h(t,i)}function e(t,i){return s&&s(void 0!==i),t.start.plus(t.startTangent.perpendicular().negated().times(i/2))}function n(t,i){return s&&s(void 0!==i),t.start.plus(t.startTangent.perpendicular().times(i/2))}var s=t("ASSERT/assert")("kite");t("ASSERT/assert")("kite.extra",!0);var r=t("KITE/kite"),h=t("DOT/Vector2"),o=t("DOT/Bounds2"),a=t("DOT/Ray2");t("DOT/Matrix3"),t("DOT/Transform3"),t("DOT/Util").toDegrees;var m=t("DOT/Util").lineLineIntersection,u=t("KITE/util/Subpath"),c=t("KITE/pieces/Piece");t("KITE/util/LineStyles"),t("KITE/pieces/Arc"),t("KITE/pieces/Close"),t("KITE/pieces/CubicCurveTo"),t("KITE/pieces/EllipticalArc"),t("KITE/pieces/LineTo"),t("KITE/pieces/MoveTo"),t("KITE/pieces/QuadraticCurveTo"),t("KITE/pieces/Rect"),t("KITE/segments/Line"),r.Shape=function(t,i){this.pieces=[],this.subpaths=[],this.bounds=o.NOTHING,this._strokedShape=null,this._strokedShapeComputed=!1,this._strokedShapeStyles=null;var e=this;void 0!==t&&_.each(t,function(t){e.addPiece(t)}),i&&this.addPiece(new c.Close)};var d=r.Shape;return d.prototype={constructor:d,moveTo:function(t,e){if(void 0===e&&"object"==typeof t){var n=t instanceof h?t:new h(t.x,t.y);this.addPiece(new c.MoveTo(n))}else this.addPiece(new c.MoveTo(i(t,e)));return this},lineTo:function(t,e){if(void 0===e&&"object"==typeof t){var n=t instanceof h?t:new h(t.x,t.y);this.addPiece(new c.LineTo(n))}else this.addPiece(new c.LineTo(i(t,e)));return this},quadraticCurveTo:function(t,e,n,s){if(void 0===n&&"object"==typeof t){var r=t instanceof h?t:new h(t.x,t.y),o=e instanceof h?e:new h(e.x,e.y);this.addPiece(new c.QuadraticCurveTo(r,o))}else this.addPiece(new c.QuadraticCurveTo(i(t,e),i(n,s)));return this},cubicCurveTo:function(t,e,n,s,r,o){if(void 0===s&&"object"==typeof t){var a=t instanceof h?t:new h(t.x,t.y),m=e instanceof h?e:new h(e.x,e.y),u=n instanceof h?n:new h(n.x,n.y);this.addPiece(new c.CubicCurveTo(a,m,u))}else this.addPiece(new c.CubicCurveTo(i(t,e),i(n,s),i(r,o)));return this},circle:function(t,e,n){if("object"==typeof t){var s=t;return n=e,this.arc(s,n,0,2*Math.PI,!1)}return this.arc(i(t,e),n,0,2*Math.PI,!1)},ellipse:function(t,e,n,s,r){if("object"==typeof t){var h=t;return r=s,s=n,n=e,this.ellipticalArc(h,n,s,r||0,0,2*Math.PI,!1)}return this.ellipticalArc(i(t,e),n,s,r||0,0,2*Math.PI,!1)},arc:function(t,e,n,s,r,h){if("object"==typeof t){h=r,r=s,s=n,n=e;var o=t;this.addPiece(new c.Arc(o,n,s,r,h))}else this.addPiece(new c.Arc(i(t,e),n,s,r,h));return this},ellipticalArc:function(t,e,n,s,r,h,o,a){if("object"==typeof t){a=o,o=h,h=r,r=s,s=n,n=e;var m=t;this.addPiece(new c.EllipticalArc(m,n,s,r,h,o,a))}else this.addPiece(new c.EllipticalArc(i(t,e),n,s,r,h,o,a));return this},rect:function(t,i,e,n){return this.addPiece(new c.Rect(t,i,e,n)),this},roundRect:function(t,i,e,n,s,r){return this.moveTo(t+s,i).lineTo(t+e-s,i).quadraticCurveTo(t+e,i,t+e,i+r).lineTo(t+e,i+n-r).quadraticCurveTo(t+e,i+n,t+e-s,i+n).lineTo(t+s,i+n).quadraticCurveTo(t,i+n,t,i+n-r).lineTo(t,i+r).quadraticCurveTo(t,i,t+s,i),this},close:function(){return this.addPiece(new c.Close),this},addPiece:function(t){return this.pieces.push(t),t.applyPiece(this),this.invalidate(),s&&s(this.bounds.isEmpty()||this.bounds.isFinite(),"shape bounds infinite after adding piece: "+t),this},writeToContext:function(t){_.each(this.pieces,function(i){i.writeToContext(t)})},getSVGPath:function(){var t=[];return _.each(this.subpaths,function(i){if(i.isDrawable()){var e=i.getFirstSegment().start;s&&s(e.equals(i.getFirstPoint(),1e-5));var n="M "+e.x+" "+e.y+" ";n+=_.map(i.segments,function(t){return t.getSVGPathFragment()}).join(" "),i.isClosed()&&(n+=" Z"),t.push(n)}}),t.join(" ")},transformed:function(t){return new d(_.flatten(_.map(this.pieces,function(i){return i.transformed(t)}),!0))},computeBounds:function(t){return t?this.bounds.union(this.getStrokedShape(t).bounds):this.bounds},containsPoint:function(t){var e=new a(t,i(1,0));return 0!==this.windingIntersection(e)},intersection:function(t){var i=[];return _.each(this.subpaths,function(e){e.isDrawable()&&(_.each(e.segments,function(e){_.each(e.intersection(t),function(t){i.push(t)})}),e.hasClosingSegment()&&_.each(e.getClosingSegment().intersection(t),function(t){i.push(t)}))}),_.sortBy(i,function(t){return t.distance})},windingIntersection:function(t){var i=0;return _.each(this.subpaths,function(e){e.isDrawable()&&(_.each(e.segments,function(e){i+=e.windingIntersection(t)}),e.hasClosingSegment()&&(i+=e.getClosingSegment().windingIntersection(t)))}),i},intersectsBounds:function(t){var i=!1;return _.each(this.subpaths,function(e){e.isDrawable()&&(_.each(e.segments,function(e){i=i&&e.intersectsBounds(t)}),e.hasClosingSegment()&&(i=i&&e.getClosingSegment().intersectsBounds(t)))}),i},invalidate:function(){this._strokedShapeComputed=!1},getStrokedShape:function(t){function i(i,e,n){var s=i.plus(e.perpendicular().negated().times(a/2)),r=i.plus(n.perpendicular().negated().times(a/2));if(e.perpendicular().dot(n)>0)switch(t.lineJoin){case"round":var h=e.angle()+Math.PI/2,u=n.angle()+Math.PI/2;o.addPiece(new c.Arc(i,a/2,h,u,!0));break;case"miter":var d=e.angleBetween(n.negated());if(Math.PI-1e-5>d,1/Math.sin(d/2)<=t.miterLimit&&Math.PI-1e-5>d){var l=m(s,s.plus(e),r,r.plus(n));o.addPiece(new c.LineTo(l)),o.addPiece(new c.LineTo(r))}else o.addPiece(new c.LineTo(r));break;case"bevel":o.addPiece(new c.LineTo(r))}else s.equals(r)||o.addPiece(new c.LineTo(r))}function s(i,e){switch(t.lineCap){case"butt":o.addPiece(new c.LineTo(i.plus(e.perpendicular().times(a/2))));break;case"round":var n=e.angle();o.addPiece(new c.Arc(i,a/2,n+Math.PI/2,n-Math.PI/2,!0));break;case"square":var s=e.perpendicular().negated().times(a/2),r=e.perpendicular().times(a/2),h=e.times(a/2);o.addPiece(new c.LineTo(i.plus(s).plus(h))),o.addPiece(new c.LineTo(i.plus(r).plus(h))),o.addPiece(new c.LineTo(i.plus(r)))}}if(void 0===t&&(t=new r.LineStyles),this._strokedShapeComputed&&this._strokedShapeStyles.equals(t))return this._strokedShape;var h=_.filter(this.subpaths,function(t){return t.isDrawable()}),o=new d,a=t.lineWidth;return _.each(h,function(t){var h,m=t.segments,u=_.last(m).end.equals(_.first(m).start),d=u?null:new r.Segment.Line(m[m.length-1].end,m[0].start);for(o.addPiece(new c.MoveTo(e(_.first(m),a))),h=0;m.length>h;h++)h>0&&i(m[h].start,m[h-1].endTangent,m[h].startTangent,!0),_.each(m[h].strokeLeft(a),function(t){o.addPiece(t)});for(t.closed?u?(i(_.last(m).end,_.last(m).endTangent,_.first(m).startTangent),o.addPiece(new c.Close),o.addPiece(new c.MoveTo(n(_.first(m),a))),i(_.last(m).end,_.first(m).startTangent.negated(),_.last(m).endTangent.negated())):(i(d.start,_.last(m).endTangent,d.startTangent),_.each(d.strokeLeft(a),function(t){o.addPiece(t)}),i(d.end,d.endTangent,_.first(m).startTangent),o.addPiece(new c.Close),o.addPiece(new c.MoveTo(n(_.first(m),a))),i(d.end,_.first(m).startTangent.negated(),d.endTangent.negated()),_.each(d.strokeRight(a),function(t){o.addPiece(t)}),i(d.start,d.startTangent.negated(),_.last(m).endTangent.negated())):s(_.last(m).end,_.last(m).endTangent),h=m.length-1;h>=0;h--)m.length-1>h&&i(m[h].end,m[h+1].startTangent.negated(),m[h].endTangent.negated(),!1),_.each(m[h].strokeRight(a),function(t){o.addPiece(t)});t.closed?o.addPiece(new c.Close):(s(_.first(m).start,_.first(m).startTangent.negated()),o.addPiece(new c.Close))}),this._strokedShape=o,this._strokedShapeComputed=!0,this._strokedShapeStyles=new r.LineStyles(t),o},ensure:function(t){this.hasSubpaths()||(this.addSubpath(new u),this.getLastSubpath().addPoint(t))},addSubpath:function(t){this.subpaths.push(t)},hasSubpaths:function(){return this.subpaths.length>0},getLastSubpath:function(){return _.last(this.subpaths)}},d.rectangle=function(t,i,e,n){return(new d).rect(t,i,e,n)},d.rect=d.rectangle,d.roundRect=function(t,i,e,n,s,r){return(new d).roundRect(t,i,e,n,s,r)},d.roundRectangle=d.roundRect,d.bounds=function(t){return(new d).rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)},d.lineSegment=function(t,i,e,n){return"number"==typeof t?(new d).moveTo(t,i).lineTo(e,n):(new d).moveTo(t).lineTo(i)},d.regularPolygon=function(t,e){var n=!0;return new d(_.map(_.range(t),function(s){var r=2*Math.PI*s/t;return n?(n=!1,new c.MoveTo(i(e*Math.cos(r),e*Math.sin(r)))):new c.LineTo(i(e*Math.cos(r),e*Math.sin(r)))}),!0)},d.circle=function(t,i,e){return void 0===i?(new d).circle(0,0,t):(new d).circle(t,i,e).close()},d.ellipse=function(t,i,e,n){return void 0===e?(new d).ellipse(0,0,t,i):(new d).ellipse(t,i,e,n).close()},d.arc=function(t,i,e,n,s,r){return(new d).arc(t,i,e,n,s,r)},d}),e("main",["KITE/kite","KITE/Shape","KITE/pieces/Arc","KITE/pieces/Close","KITE/pieces/CubicCurveTo","KITE/pieces/EllipticalArc","KITE/pieces/LineTo","KITE/pieces/MoveTo","KITE/pieces/Piece","KITE/pieces/QuadraticCurveTo","KITE/pieces/Rect","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/LineStyles","KITE/util/Subpath"],function(t){return t}),e("DOT/ConvexHull2",["require","ASSERT/assert","DOT/dot"],function(t){function i(t,i,e){return i.minus(t).crossScalar(e.minus(t))}t("ASSERT/assert")("dot");var e=t("DOT/dot");return e.ConvexHull2={grahamScan:function(t,e){if(2>=t.length)return t;var n=Number.POSITIVE_INFINITY,s=null;_.each(t,function(t){n>=t.y&&(t.y===n&&s?t.x<s.x&&(s=t):(n=t.y,s=t))}),t=_.sortBy(t,function(t){return t.minus(s).angle()}),t.splice(_.indexOf(t,s),1);var r=[s];return _.each(t,function(t){function n(){if(2>r.length)return!1;var n=i(r[r.length-2],r[r.length-1],t);return e?0>n:0>=n}if(s.x!==t.x||s.y!==t.y){for(;n();)r.pop();r.push(t)}}),r}},e.ConvexHull2}),e("DOT/Dimension2",["require","DOT/dot"],function(t){var i=t("DOT/dot");i.Dimension2=function(t,i){this.width=t,this.height=i};var e=i.Dimension2;return e.prototype={constructor:e,toString:function(){return"["+this.width+"w, "+this.height+"h]"},equals:function(t){return this.width===t.width&&this.height===t.height}},e}),e("DOT/LUDecomposition",["require","DOT/dot"],function(t){var i=t("DOT/dot"),e=window.Float32Array||Array;i.LUDecomposition=function(t){var i,n,s;this.matrix=t,this.LU=t.getArrayCopy();var r=this.LU;this.m=t.getRowDimension();var h=this.m;this.n=t.getColumnDimension();var o=this.n;for(this.piv=new Uint32Array(h),i=0;h>i;i++)this.piv[i]=i;this.pivsign=1;var a=new e(h);for(n=0;o>n;n++){for(i=0;h>i;i++)a[i]=r[t.index(i,n)];for(i=0;h>i;i++){var m=Math.min(i,n),u=0;for(s=0;m>s;s++){var c=t.index(i,s);u+=r[c]*a[s]}a[i]-=u,r[t.index(i,n)]=a[i]}var d=n;for(i=n+1;h>i;i++)Math.abs(a[i])>Math.abs(a[d])&&(d=i);if(d!==n){for(s=0;o>s;s++){var l=t.index(d,s),f=t.index(n,s),p=r[l];r[l]=r[f],r[f]=p}s=this.piv[d],this.piv[d]=this.piv[n],this.piv[n]=s,this.pivsign=-this.pivsign}if(h>n&&0!==r[this.matrix.index(n,n)])for(i=n+1;h>i;i++)r[t.index(i,n)]/=r[t.index(n,n)]}};var n=i.LUDecomposition;return n.prototype={constructor:n,isNonsingular:function(){for(var t=0;this.n>t;t++){var i=this.matrix.index(t,t);if(0===this.LU[i])return!1}return!0},getL:function(){for(var t=new i.Matrix(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++)t.entries[t.index(e,n)]=e>n?this.LU[this.matrix.index(e,n)]:e===n?1:0;return t},getU:function(){for(var t=new i.Matrix(this.n,this.n),e=0;this.n>e;e++)for(var n=0;this.n>n;n++)t.entries[t.index(e,n)]=n>=e?this.LU[this.matrix.index(e,n)]:0;return t},getPivot:function(){for(var t=new Uint32Array(this.m),i=0;this.m>i;i++)t[i]=this.piv[i];return t},getDoublePivot:function(){for(var t=new e(this.m),i=0;this.m>i;i++)t[i]=this.piv[i];return t},det:function(){if(this.m!==this.n)throw Error("Matrix must be square.");for(var t=this.pivsign,i=0;this.n>i;i++)t*=this.LU[this.matrix.index(i,i)];return t},solve:function(t){var i,e,n;if(t.getRowDimension()!==this.m)throw Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw Error("Matrix is singular.");var s=t.getColumnDimension(),r=t.getArrayRowMatrix(this.piv,0,s-1);for(n=0;this.n>n;n++)for(i=n+1;this.n>i;i++)for(e=0;s>e;e++)r.entries[r.index(i,e)]-=r.entries[r.index(n,e)]*this.LU[this.matrix.index(i,n)];for(n=this.n-1;n>=0;n--){for(e=0;s>e;e++)r.entries[r.index(n,e)]/=this.LU[this.matrix.index(n,n)];for(i=0;n>i;i++)for(e=0;s>e;e++)r.entries[r.index(i,e)]-=r.entries[r.index(n,e)]*this.LU[this.matrix.index(i,n)]}return r}},n}),e("PHET_CORE/isArray",["require"],function(){return function(t){return"[object Array]"===Object.prototype.toString.call(t)}}),e("DOT/SingularValueDecomposition",["require","DOT/dot"],function(t){var i=t("DOT/dot"),e=window.Float32Array||Array;i.SingularValueDecomposition=function(t){this.matrix=t;var n=t,s=n.getArrayCopy();this.m=n.getRowDimension(),this.n=n.getColumnDimension();var r=this.m,h=this.n,o=Math.min,a=Math.max,m=Math.pow,u=Math.abs,c=o(r,h);this.s=new e(o(r+1,h));var d=this.s;this.U=new e(r*c);var l=this.U;this.V=new e(h*h);var f,p,T,g,x,v,y,w=this.V,E=new e(h),I=new e(r),S=!0,A=!0,b=i.Matrix.hypot,D=o(r-1,h),M=a(0,o(h-2,r));for(T=0;a(D,M)>T;T++){if(D>T){for(d[T]=0,f=T;r>f;f++)d[T]=b(d[T],s[f*h+T]);if(0!==d[T]){for(0>s[T*h+T]&&(d[T]=-d[T]),f=T;r>f;f++)s[f*h+T]/=d[T];s[T*h+T]+=1}d[T]=-d[T]}for(p=T+1;h>p;p++){if(D>T&&0!==d[T]){for(g=0,f=T;r>f;f++)g+=s[f*h+T]*s[f*h+p];for(g=-g/s[T*h+T],f=T;r>f;f++)s[f*h+p]+=g*s[f*h+T]}E[p]=s[T*h+p]}if(S&&D>T)for(f=T;r>f;f++)l[f*c+T]=s[f*h+T];if(M>T){for(E[T]=0,f=T+1;h>f;f++)E[T]=b(E[T],E[f]);if(0!==E[T]){for(0>E[T+1]&&(E[T]=-E[T]),f=T+1;h>f;f++)E[f]/=E[T];E[T+1]+=1}if(E[T]=-E[T],r>T+1&&0!==E[T]){for(f=T+1;r>f;f++)I[f]=0;for(p=T+1;h>p;p++)for(f=T+1;r>f;f++)I[f]+=E[p]*s[f*h+p];for(p=T+1;h>p;p++)for(g=-E[p]/E[T+1],f=T+1;r>f;f++)s[f*h+p]+=g*I[f]}if(A)for(f=T+1;h>f;f++)w[f*h+T]=E[f]}}var O=o(h,r+1);if(h>D&&(d[D]=s[D*h+D]),O>r&&(d[O-1]=0),O>M+1&&(E[M]=s[M*h+O-1]),E[O-1]=0,S){for(p=D;c>p;p++){for(f=0;r>f;f++)l[f*c+p]=0;l[p*c+p]=1}for(T=D-1;T>=0;T--)if(0!==d[T]){for(p=T+1;c>p;p++){for(g=0,f=T;r>f;f++)g+=l[f*c+T]*l[f*c+p];for(g=-g/l[T*c+T],f=T;r>f;f++)l[f*c+p]+=g*l[f*c+T]}for(f=T;r>f;f++)l[f*c+T]=-l[f*c+T];for(l[T*c+T]=1+l[T*c+T],f=0;T-1>f;f++)l[f*c+T]=0}else{for(f=0;r>f;f++)l[f*c+T]=0;l[T*c+T]=1}}if(A)for(T=h-1;T>=0;T--){if(M>T&&0!==E[T])for(p=T+1;c>p;p++){for(g=0,f=T+1;h>f;f++)g+=w[f*h+T]*w[f*h+p];for(g=-g/w[T+1*h+T],f=T+1;h>f;f++)w[f*h+p]+=g*w[f*h+T]}for(f=0;h>f;f++)w[f*h+T]=0;
w[T*h+T]=1}for(var P=O-1,R=0,V=m(2,-52),C=m(2,-966);O>0;){var z;for(T=O-2;T>=-1&&-1!==T;T--)if(u(E[T])<=C+V*(u(d[T])+u(d[T+1]))){E[T]=0;break}if(T===O-2)z=4;else{var L;for(L=O-1;L>=T&&L!==T;L--)if(g=(L!==O?u(E[L]):0)+(L!==T+1?u(E[L-1]):0),C+V*g>=u(d[L])){d[L]=0;break}L===T?z=3:L===O-1?z=1:(z=2,T=L)}switch(T++,z){case 1:for(x=E[O-2],E[O-2]=0,p=O-2;p>=T;p--)if(g=b(d[p],x),v=d[p]/g,y=x/g,d[p]=g,p!==T&&(x=-y*E[p-1],E[p-1]=v*E[p-1]),A)for(f=0;h>f;f++)g=v*w[f*h+p]+y*w[f*h+O-1],w[f*h+O-1]=-y*w[f*h+p]+v*w[f*h+O-1],w[f*h+p]=g;break;case 2:for(x=E[T-1],E[T-1]=0,p=T;O>p;p++)if(g=b(d[p],x),v=d[p]/g,y=x/g,d[p]=g,x=-y*E[p],E[p]=v*E[p],S)for(f=0;r>f;f++)g=v*l[f*c+p]+y*l[f*c+T-1],l[f*c+T-1]=-y*l[f*c+p]+v*l[f*c+T-1],l[f*c+p]=g;break;case 3:var Y=a(a(a(a(u(d[O-1]),u(d[O-2])),u(E[O-2])),u(d[T])),u(E[T])),N=d[O-1]/Y,K=d[O-2]/Y,k=E[O-2]/Y,_=d[T]/Y,X=E[T]/Y,q=((K+N)*(K-N)+k*k)/2,H=N*k*N*k,F=0;(0!==q||0!==H)&&(F=Math.sqrt(q*q+H),0>q&&(F=-F),F=H/(q+F)),x=(_+N)*(_-N)+F;var U=_*X;for(p=T;O-1>p;p++){if(g=b(x,U),v=x/g,y=U/g,p!==T&&(E[p-1]=g),x=v*d[p]+y*E[p],E[p]=v*E[p]-y*d[p],U=y*d[p+1],d[p+1]=v*d[p+1],A)for(f=0;h>f;f++)g=v*w[f*h+p]+y*w[f*h+p+1],w[f*h+p+1]=-y*w[f*h+p]+v*w[f*h+p+1],w[f*h+p]=g;if(g=b(x,U),v=x/g,y=U/g,d[p]=g,x=v*E[p]+y*d[p+1],d[p+1]=-y*E[p]+v*d[p+1],U=y*E[p+1],E[p+1]=v*E[p+1],S&&r-1>p)for(f=0;r>f;f++)g=v*l[f*c+p]+y*l[f*c+p+1],l[f*c+p+1]=-y*l[f*c+p]+v*l[f*c+p+1],l[f*c+p]=g}E[O-2]=x,R+=1;break;case 4:if(0>=d[T]&&(d[T]=0>d[T]?-d[T]:0,A))for(f=0;P>=f;f++)w[f*h+T]=-w[f*h+T];for(;P>T&&!(d[T]>=d[T+1]);){if(g=d[T],d[T]=d[T+1],d[T+1]=g,A&&h-1>T)for(f=0;h>f;f++)g=w[f*h+T+1],w[f*h+T+1]=w[f*h+T],w[f*h+T]=g;if(S&&r-1>T)for(f=0;r>f;f++)g=l[f*c+T+1],l[f*c+T+1]=l[f*c+T],l[f*c+T]=g;T++}R=0,O--}}};var n=i.SingularValueDecomposition;n.prototype={constructor:n,getU:function(){return new i.Matrix(this.m,Math.min(this.m+1,this.n),this.U,!0)},getV:function(){return new i.Matrix(this.n,this.n,this.V,!0)},getSingularValues:function(){return this.s},getS:function(){for(var t=new i.Matrix(this.n,this.n),e=0;this.n>e;e++){for(var n=0;this.n>n;n++)t.entries[t.index(e,n)]=0;t.entries[t.index(e,e)]=this.s[e]}return t},norm2:function(){return this.s[0]},cond:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},rank:function(){for(var t=Math.pow(2,-23),i=Math.max(this.m,this.n)*this.s[0]*t,e=0,n=0;this.s.length>n;n++)this.s[n]>i&&e++;return e}}}),e("DOT/QRDecomposition",["require","DOT/dot"],function(t){var i=t("DOT/dot"),e=window.Float32Array||Array;i.QRDecomposition=function(t){this.matrix=t,this.QR=t.getArrayCopy();var n=this.QR;this.m=t.getRowDimension();var s=this.m;this.n=t.getColumnDimension();var r=this.n;this.Rdiag=new e(r);var h,o,a;for(a=0;r>a;a++){var m=0;for(h=a;s>h;h++)m=i.Matrix.hypot(m,n[this.matrix.index(h,a)]);if(0!==m){for(0>n[this.matrix.index(a,a)]&&(m=-m),h=a;s>h;h++)n[this.matrix.index(h,a)]/=m;for(n[this.matrix.index(a,a)]+=1,o=a+1;r>o;o++){var u=0;for(h=a;s>h;h++)u+=n[this.matrix.index(h,a)]*n[this.matrix.index(h,o)];for(u=-u/n[this.matrix.index(a,a)],h=a;s>h;h++)n[this.matrix.index(h,o)]+=u*n[this.matrix.index(h,a)]}}this.Rdiag[a]=-m}};var n=i.QRDecomposition;return n.prototype={constructor:n,isFullRank:function(){for(var t=0;this.n>t;t++)if(0===this.Rdiag[t])return!1;return!0},getH:function(){for(var t=new i.Matrix(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++)t.entries[t.index(e,n)]=e>=n?this.QR[this.matrix.index(e,n)]:0;return t},getR:function(){for(var t=new i.Matrix(this.n,this.n),e=0;this.n>e;e++)for(var n=0;this.n>n;n++)t.entries[t.index(e,n)]=n>e?this.QR[this.matrix.index(e,n)]:e===n?this.Rdiag[e]:0;return t},getQ:function(){var t,e,n,s=new i.Matrix(this.m,this.n);for(n=this.n-1;n>=0;n--){for(t=0;this.m>t;t++)s.entries[s.index(t,n)]=0;for(s.entries[s.index(n,n)]=1,e=n;this.n>e;e++)if(0!==this.QR[this.matrix.index(n,n)]){var r=0;for(t=n;this.m>t;t++)r+=this.QR[this.matrix.index(t,n)]*s.entries[s.index(t,e)];for(r=-r/this.QR[this.matrix.index(n,n)],t=n;this.m>t;t++)s.entries[s.index(t,e)]+=r*this.QR[this.matrix.index(t,n)]}}return s},solve:function(t){if(t.getRowDimension()!==this.m)throw Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw Error("Matrix is rank deficient.");var e,n,s,r=t.getColumnDimension(),h=t.getArrayCopy();for(s=0;this.n>s;s++)for(n=0;r>n;n++){var o=0;for(e=s;this.m>e;e++)o+=this.QR[this.matrix.index(e,s)]*h[t.index(e,n)];for(o=-o/this.QR[this.matrix.index(s,s)],e=s;this.m>e;e++)h[t.index(e,n)]+=o*this.QR[this.matrix.index(e,s)]}for(s=this.n-1;s>=0;s--){for(n=0;r>n;n++)h[t.index(s,n)]/=this.Rdiag[s];for(e=0;s>e;e++)for(n=0;r>n;n++)h[t.index(e,n)]-=h[t.index(s,n)]*this.QR[this.matrix.index(e,s)]}return new i.Matrix(h,this.n,r).getMatrix(0,this.n-1,0,r-1)}},n}),e("DOT/Matrix",["require","ASSERT/assert","DOT/dot","PHET_CORE/isArray","DOT/SingularValueDecomposition","DOT/LUDecomposition","DOT/QRDecomposition","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){var i=t("ASSERT/assert")("dot"),e=t("DOT/dot"),n=window.Float32Array||Array,s=t("PHET_CORE/isArray");t("DOT/SingularValueDecomposition"),t("DOT/LUDecomposition"),t("DOT/QRDecomposition"),t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Vector4"),e.Matrix=function(t,e,r,h){this.m=t,this.n=e;var o=t*e;this.size=o;var a;if(h)this.entries=r;else if(r||(r=0),this.entries=new n(o),s(r))for(i&&i(r.length===o),a=0;o>a;a++)this.entries[a]=r[a];else for(a=0;o>a;a++)this.entries[a]=r};var r=e.Matrix;return r.hypot=function(t,i){var e;return Math.abs(t)>Math.abs(i)?(e=i/t,e=Math.abs(t)*Math.sqrt(1+e*e)):0!==i?(e=t/i,e=Math.abs(i)*Math.sqrt(1+e*e)):e=0,e},r.prototype={constructor:r,copy:function(){for(var t=new r(this.m,this.n),i=0;this.size>i;i++)t.entries[i]=this.entries[i];return t},getArray:function(){return this.entries},getArrayCopy:function(){return new n(this.entries)},getRowDimension:function(){return this.m},getColumnDimension:function(){return this.n},index:function(t,i){return t*this.n+i},get:function(t,i){return this.entries[this.index(t,i)]},set:function(t,i,e){this.entries[this.index(t,i)]=e},getMatrix:function(t,i,e,n){for(var s=new r(i-t+1,n-e+1),h=t;i>=h;h++)for(var o=e;n>=o;o++)s.entries[s.index(h-t,o-e)]=this.entries[this.index(h,o)];return s},getArrayRowMatrix:function(t,i,e){for(var n=new r(t.length,e-i+1),s=0;t.length>s;s++)for(var h=i;e>=h;h++)n.entries[n.index(s,h-i)]=this.entries[this.index(t[s],h)];return n},transpose:function(){for(var t=new r(this.n,this.m),i=0;this.m>i;i++)for(var e=0;this.n>e;e++)t.entries[t.index(e,i)]=this.entries[this.index(i,e)];return t},norm1:function(){for(var t=0,i=0;this.n>i;i++){for(var e=0,n=0;this.m>n;n++)e+=Math.abs(this.entries[this.index(n,i)]);t=Math.max(t,e)}return t},norm2:function(){return new e.SingularValueDecomposition(this).norm2()},normInf:function(){for(var t=0,i=0;this.m>i;i++){for(var e=0,n=0;this.n>n;n++)e+=Math.abs(this.entries[this.index(i,n)]);t=Math.max(t,e)}return t},normF:function(){for(var t=0,i=0;this.m>i;i++)for(var e=0;this.n>e;e++)t=r.hypot(t,this.entries[this.index(i,e)]);return t},uminus:function(){for(var t=new r(this.m,this.n),i=0;this.m>i;i++)for(var e=0;this.n>e;e++)t.entries[t.index(i,e)]=-this.entries[this.index(i,e)];return t},plus:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=i.index(e,n);i.entries[s]=this.entries[s]+t.entries[s]}return i},plusEquals:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=i.index(e,n);this.entries[s]=this.entries[s]+t.entries[s]}return this},minus:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=this.index(e,n);i.entries[s]=this.entries[s]-t.entries[s]}return i},minusEquals:function(t){this.checkMatrixDimensions(t);for(var i=0;this.m>i;i++)for(var e=0;this.n>e;e++){var n=this.index(i,e);this.entries[n]=this.entries[n]-t.entries[n]}return this},arrayTimes:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=i.index(e,n);i.entries[s]=this.entries[s]*t.entries[s]}return i},arrayTimesEquals:function(t){this.checkMatrixDimensions(t);for(var i=0;this.m>i;i++)for(var e=0;this.n>e;e++){var n=this.index(i,e);this.entries[n]=this.entries[n]*t.entries[n]}return this},arrayRightDivide:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=this.index(e,n);i.entries[s]=this.entries[s]/t.entries[s]}return i},arrayRightDivideEquals:function(t){this.checkMatrixDimensions(t);for(var i=0;this.m>i;i++)for(var e=0;this.n>e;e++){var n=this.index(i,e);this.entries[n]=this.entries[n]/t.entries[n]}return this},arrayLeftDivide:function(t){this.checkMatrixDimensions(t);for(var i=new r(this.m,this.n),e=0;this.m>e;e++)for(var n=0;this.n>n;n++){var s=this.index(e,n);i.entries[s]=t.entries[s]/this.entries[s]}return i},arrayLeftDivideEquals:function(t){this.checkMatrixDimensions(t);for(var i=0;this.m>i;i++)for(var e=0;this.n>e;e++){var n=this.index(i,e);this.entries[n]=t.entries[n]/this.entries[n]}return this},times:function(t){var i,e,s,h,o,a;if(t.isMatrix){if(a=t,a.m!==this.n)throw Error("Matrix inner dimensions must agree.");i=new r(this.m,a.n);var m=new n(this.n);for(s=0;a.n>s;s++){for(h=0;this.n>h;h++)m[h]=a.entries[a.index(h,s)];for(e=0;this.m>e;e++){for(o=0,h=0;this.n>h;h++)o+=this.entries[this.index(e,h)]*m[h];i.entries[i.index(e,s)]=o}}return i}for(o=t,i=new r(this.m,this.n),e=0;this.m>e;e++)for(s=0;this.n>s;s++)i.entries[i.index(e,s)]=o*this.entries[this.index(e,s)];return i},timesEquals:function(t){for(var i=0;this.m>i;i++)for(var e=0;this.n>e;e++){var n=this.index(i,e);this.entries[n]=t*this.entries[n]}return this},solve:function(t){return this.m===this.n?new e.LUDecomposition(this).solve(t):new e.QRDecomposition(this).solve(t)},solveTranspose:function(t){return this.transpose().solve(t.transpose())},inverse:function(){return this.solve(r.identity(this.m,this.m))},det:function(){return new e.LUDecomposition(this).det()},rank:function(){return new e.SingularValueDecomposition(this).rank()},cond:function(){return new e.SingularValueDecomposition(this).cond()},trace:function(){for(var t=0,i=0;Math.min(this.m,this.n)>i;i++)t+=this.entries[this.index(i,i)];return t},checkMatrixDimensions:function(t){if(t.m!==this.m||t.n!==this.n)throw Error("Matrix dimensions must agree.")},toString:function(){var t="";t+="dim: "+this.getRowDimension()+"x"+this.getColumnDimension()+"\n";for(var i=0;this.getRowDimension()>i;i++){for(var e=0;this.getColumnDimension()>e;e++)t+=this.get(i,e)+" ";t+="\n"}return t},extractVector2:function(t){return i&&i(2===this.m),new e.Vector2(this.get(0,t),this.get(1,t))},extractVector3:function(t){return i&&i(3===this.m),new e.Vector3(this.get(0,t),this.get(1,t),this.get(2,t))},extractVector4:function(t){return i&&i(4===this.m),new e.Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))},isMatrix:!0},r.identity=function(t,i){for(var e=new r(t,i),n=0;t>n;n++)for(var s=0;i>s;s++)e.entries[e.index(n,s)]=n===s?1:0;return e},r.rowVector2=function(t){return new r(1,2,[t.x,t.y])},r.rowVector3=function(t){return new r(1,3,[t.x,t.y,t.z])},r.rowVector4=function(t){return new r(1,4,[t.x,t.y,t.z,t.w])},r.rowVector=function(t){if(t.isVector2)return r.rowVector2(t);if(t.isVector3)return r.rowVector3(t);if(t.isVector4)return r.rowVector4(t);throw Error("undetected type of vector: "+(""+t))},r.columnVector2=function(t){return new r(2,1,[t.x,t.y])},r.columnVector3=function(t){return new r(3,1,[t.x,t.y,t.z])},r.columnVector4=function(t){return new r(4,1,[t.x,t.y,t.z,t.w])},r.columnVector=function(t){if(t.isVector2)return r.columnVector2(t);if(t.isVector3)return r.columnVector3(t);if(t.isVector4)return r.columnVector4(t);throw Error("undetected type of vector: "+(""+t))},r.fromVectors2=function(t){for(var i=2,e=t.length,s=new n(i*e),h=0;e>h;h++){var o=t[h];s[h]=o.x,s[h+e]=o.y}return new r(i,e,s,!0)},r.fromVectors3=function(t){for(var i=3,e=t.length,s=new n(i*e),h=0;e>h;h++){var o=t[h];s[h]=o.x,s[h+e]=o.y,s[h+2*e]=o.z}return new r(i,e,s,!0)},r.fromVectors4=function(t){for(var i=4,e=t.length,s=new n(i*e),h=0;e>h;h++){var o=t[h];s[h]=o.x,s[h+e]=o.y,s[h+2*e]=o.z,s[h+3*e]=o.w}return new r(i,e,s,!0)},r}),e("DOT/Permutation",["require","ASSERT/assert","DOT/dot","PHET_CORE/isArray","DOT/Util"],function(t){function i(t,e,n){if(0===t.length)n.call(void 0,e);else for(var s=0;t.length>s;s++){var r=t[s],h=t.slice(0);h.splice(s,1);var o=e.slice(0);o.push(r),i(h,o,n)}}var e=t("ASSERT/assert")("dot"),n=t("DOT/dot"),s=t("PHET_CORE/isArray");t("DOT/Util");var r=function(t){this.indices=t};return r.identity=function(t){e&&e(t>=0);for(var i=Array(t),n=0;t>n;n++)i[n]=n;return new r(i)},r.permutations=function(t){var i=[];return r.forEachPermutation(n.rangeInclusive(0,t-1),function(t){i.push(new r(t))}),i},r.forEachPermutation=function(t,e){i(t,[],e)},r.prototype={constructor:r,size:function(){return this.indices.length},apply:function(t){if(s(t)){if(t.length!==this.size())throw Error("Permutation length "+this.size()+" not equal to list length "+t.length);for(var i=Array(t.length),e=0;t.length>e;e++)i[e]=t[this.indices[e]];return i}return this.indices[t]},inverted:function(){for(var t=Array(this.size()),i=0;this.size()>i;i++)t[this.indices[i]]=i;return new r(t)},withIndicesPermuted:function(t){var i=[],e=this;return r.forEachPermutation(t,function(n){for(var s=e.indices,h=s.slice(0),o=0;t.length>o;o++)h[t[o]]=s[n[o]];i.push(new r(h))}),i},toString:function(){return"P["+this.indices.join(", ")+"]"}},r.testMe=function(t){var i=new r([1,4,3,2,0]);t.log(""+i);var e=i.inverted();t.log(""+e),t.log(""+e.withIndicesPermuted([0,3,4])),t.log(""+r.permutations(4))},r}),e("DOT/Ray3",["require","DOT/dot"],function(t){var i=t("DOT/dot");i.Ray3=function(t,i){this.pos=t,this.dir=i};var e=i.Ray3;return e.prototype={constructor:e,shifted:function(t){return new e(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return""+this.pos+" => "+(""+this.dir)}},e}),e("DOT/Transform4",["require","DOT/dot","DOT/Matrix4","DOT/Vector3","DOT/Ray3"],function(t){var i=t("DOT/dot");t("DOT/Matrix4"),t("DOT/Vector3"),t("DOT/Ray3"),i.Transform4=function(t){this.set(void 0===t?i.Matrix4.IDENTITY:t)};var e=i.Transform4;return e.prototype={constructor:e,set:function(t){this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},prepend:function(t){this.set(t.timesMatrix(this.matrix))},append:function(t){this.set(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},isIdentity:function(){return this.matrix.type===i.Matrix4.Types.IDENTITY},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())},transformPosition3:function(t){return this.matrix.timesVector3(t)},transformDelta3:function(t){return this.matrix.timesRelativeVector3(t)},transformNormal3:function(t){return this.getInverse().timesTransposeVector3(t)},transformDeltaX:function(t){return this.transformDelta3(new i.Vector3(t,0,0)).x},transformDeltaY:function(t){return this.transformDelta3(new i.Vector3(0,t,0)).y},transformDeltaZ:function(t){return this.transformDelta3(new i.Vector3(0,0,t)).z},transformRay:function(t){return new i.Ray3(this.transformPosition3(t.pos),this.transformPosition3(t.pos.plus(t.dir)).minus(this.transformPosition3(t.pos)))},inversePosition3:function(t){return this.getInverse().timesVector3(t)},inverseDelta3:function(t){return this.inversePosition3(t).minus(this.inversePosition3(i.Vector3.ZERO))},inverseNormal3:function(t){return this.matrix.timesTransposeVector3(t)},inverseDeltaX:function(t){return this.inverseDelta3(new i.Vector3(t,0,0)).x},inverseDeltaY:function(t){return this.inverseDelta3(new i.Vector3(0,t,0)).y},inverseDeltaZ:function(t){return this.inverseDelta3(new i.Vector3(0,0,t)).z},inverseRay:function(t){return new i.Ray3(this.inversePosition3(t.pos),this.inversePosition3(t.pos.plus(t.dir)).minus(this.inversePosition3(t.pos)))}},e}),e("DOT/main",["DOT/dot","DOT/Bounds2","DOT/ConvexHull2","DOT/Dimension2","DOT/LUDecomposition","DOT/Matrix","DOT/Matrix3","DOT/Matrix4","DOT/Permutation","DOT/QRDecomposition","DOT/Ray2","DOT/Ray3","DOT/SingularValueDecomposition","DOT/Transform3","DOT/Transform4","DOT/Util","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){return t}),e("PHET_CORE/callSuper",["require"],function(){function t(t,i,e){(function(){var e=t.prototype[i];Function.call.apply(e,arguments)})(e)}return t}),e("PHET_CORE/extend",["require"],function(){return function(t){return _.each(Array.prototype.slice.call(arguments,1),function(i){if(i)for(var e in i)Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}),t}}),e("PHET_CORE/inherit",["require","PHET_CORE/extend"],function(t){function i(t,i,n){function s(){}s.prototype=i.prototype,t.prototype=e(new s,{constructor:t},n)}var e=t("PHET_CORE/extend");return i}),e("PHET_CORE/inheritPrototype",["require"],function(){function t(t,i){var e=Object(i.prototype);e.constructor=t,t.prototype=e}return t}),e("PHET_CORE/loadScript",["require"],function(){return function(t){"string"==typeof t&&(t={src:t});var i=t.src,e=t.callback,n=void 0===t.async?!0:t.async,s=void 0===t.cacheBuster?!1:t.cacheBuster,r=!1,h=document.createElement("script");h.type="text/javascript",h.async=n,h.onload=h.onreadystatechange=function(){var t=this.readyState;t&&"complete"!==t&&"loaded"!==t||r||(r=!0,e&&e())},h.src=i+(s?"?random="+Math.random().toFixed(10):"");var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(h,o)}}),e("PHET_CORE/main",["require","PHET_CORE/callSuper","PHET_CORE/inherit","PHET_CORE/inheritPrototype","PHET_CORE/isArray","PHET_CORE/extend","PHET_CORE/loadScript"],function(t){return{callSuper:t("PHET_CORE/callSuper"),inherit:t("PHET_CORE/inherit"),inheritPrototype:t("PHET_CORE/inheritPrototype"),isArray:t("PHET_CORE/isArray"),extend:t("PHET_CORE/extend"),loadScript:t("PHET_CORE/loadScript")}}),window.has&&(window.has.add("assert.kite",function(){return!1}),window.has.add("assert.kite.extra",function(){return!1})),window.loadedKiteConfig=!0,i.config({deps:["main","DOT/main","PHET_CORE/main"],paths:{underscore:"../contrib/lodash.min-1.0.0-rc.3",KITE:".",DOT:"../common/dot/js",PHET_CORE:"../common/phet-core/js",ASSERT:"../common/assert/js"},shim:{underscore:{exports:"_"}},urlArgs:(new Date).getTime()}),e("production-config",function(){}),window.kite=i("main"),window.dot=i("DOT/main")})();
//@ sourceMappingURL=kite.min.js.map